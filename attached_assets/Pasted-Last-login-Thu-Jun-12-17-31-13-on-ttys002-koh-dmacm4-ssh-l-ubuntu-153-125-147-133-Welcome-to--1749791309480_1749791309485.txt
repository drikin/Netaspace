Last login: Thu Jun 12 17:31:13 on ttys002
koh@dmacm4 ~ % ssh -l ubuntu 153.125.147.133 
Welcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-60-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Fri Jun 13 09:33:48 AM JST 2025

  System load:  0.0                Processes:             495
  Usage of /:   23.2% of 19.51GB   Users logged in:       1
  Memory usage: 1%                 IPv4 address for eth0: 153.125.147.133
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

3 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

1 additional security update can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm


Last login: Fri Jun 13 05:34:51 2025 from 69.36.134.42
ubuntu@neta:~$ cd Netaspace/
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 12, done.
remote: Counting objects: 100% (12/12), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 9 (delta 2), reused 9 (delta 2), pack-reused 0 (from 0)
Unpacking objects: 100% (9/9), 6.95 KiB | 2.32 MiB/s, done.
From github.com:drikin/Netaspace
   391667e..b169872  main       -> origin/main
Updating 391667e..b169872
Fast-forward
 .env.production           |  18 +++++++----
 DNS_SETUP.md              |  88 +++++++++++++++++++++++++++++++++++++++++++++++++++++
 SAKURA_DEPLOY_COMPLETE.md |  62 ++++++++++++++++++++++++++++++++++++++
 database-setup.sql        |  84 +++++++++++++++++++++++++++++++++++++++++++++++++++
 deploy-commands.sh        | 120 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 nginx-config.conf         |   4 +--
 quick-deploy.sh           | 123 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 7 files changed, 491 insertions(+), 8 deletions(-)
 create mode 100644 DNS_SETUP.md
 create mode 100644 SAKURA_DEPLOY_COMPLETE.md
 create mode 100644 database-setup.sql
 create mode 100644 deploy-commands.sh
 create mode 100644 quick-deploy.sh
ubuntu@neta:~/Netaspace$ cp .env.production .env
ubuntu@neta:~/Netaspace$ less .env
ubuntu@neta:~/Netaspace$ sh ./quick-deploy.sh 
Quick Deploy to 153.125.147.133
================================
Step 1: System update...
Hit:1 https://download.docker.com/linux/ubuntu noble InRelease
Hit:2 http://archive.ubuntu.com/ubuntu noble InRelease                   
Get:3 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]
Get:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]
Get:5 http://security.ubuntu.com/ubuntu noble-security/main amd64 Packages [868 kB]
Get:6 http://archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]
Get:7 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 Packages [1,117 kB]
Get:8 http://security.ubuntu.com/ubuntu noble-security/main amd64 Components [21.6 kB]
Get:9 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Packages [849 kB]
Get:10 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Components [52.2 kB]       
Get:11 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Components [212 B]         
Get:12 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Components [212 B]
Get:13 http://archive.ubuntu.com/ubuntu noble-updates/main Translation-en [238 kB]
Get:14 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 Components [161 kB]
Get:15 http://archive.ubuntu.com/ubuntu noble-updates/universe amd64 Packages [1,078 kB]
Get:16 http://archive.ubuntu.com/ubuntu noble-updates/universe amd64 Components [376 kB]
Get:17 http://archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Components [212 B]
Get:18 http://archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Components [940 B]
Get:19 http://archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [7,088 B]
Get:20 http://archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [16.4 kB]
Get:21 http://archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [216 B]
Get:22 http://archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B]
Fetched 5,164 kB in 4s (1,332 kB/s)              
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
4 packages can be upgraded. Run 'apt list --upgradable' to see them.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (8.5.0-2ubuntu10.6).
git is already the newest version (1:2.43.0-1ubuntu7.2).
nginx is already the newest version (1.24.0-2ubuntu7.3).
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
Step 2: Installing Node.js...
/usr/bin/node
2025-06-13 09:35:36 - Installing pre-requisites
Hit:1 https://download.docker.com/linux/ubuntu noble InRelease
Hit:2 http://archive.ubuntu.com/ubuntu noble InRelease                                                   
Hit:3 http://security.ubuntu.com/ubuntu noble-security InRelease                                         
Hit:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
apt-transport-https is already the newest version (2.8.3).
ca-certificates is already the newest version (20240203).
curl is already the newest version (8.5.0-2ubuntu10.6).
gnupg is already the newest version (2.4.4-2ubuntu17.2).
gnupg set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
Hit:1 http://archive.ubuntu.com/ubuntu noble InRelease
Hit:2 http://security.ubuntu.com/ubuntu noble-security InRelease
Hit:3 https://download.docker.com/linux/ubuntu noble InRelease             
Hit:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease             
Hit:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease        
Get:6 https://deb.nodesource.com/node_20.x nodistro InRelease [12.1 kB]
Get:7 https://deb.nodesource.com/node_20.x nodistro/main amd64 Packages [11.5 kB]
Fetched 23.7 kB in 1s (26.6 kB/s)     
Reading package lists... Done
2025-06-13 09:35:40 - Repository configured successfully.
2025-06-13 09:35:40 - To install Node.js, run: apt-get install nodejs -y
2025-06-13 09:35:40 - You can use N|solid Runtime as a node.js alternative
2025-06-13 09:35:40 - To install N|solid Runtime, run: apt-get install nsolid -y 

Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  gyp handlebars javascript-common libcares2 libdrm-amdgpu1 libdrm-intel1 libdrm-nouveau2 libdrm-radeon1
  libegl-mesa0 libegl1 libfile-basedir-perl libfile-desktopentry-perl libfile-mimeinfo-perl libgbm1 libgl1
  libgl1-amber-dri libgl1-mesa-dri libglapi-mesa libgles2 libglvnd0 libglx-mesa0 libglx0 libice6
  libio-stringy-perl libipc-system-simple-perl libjs-async libjs-events libjs-inherits libjs-is-typedarray
  libjs-prettify libjs-regenerate libjs-source-map libjs-sprintf-js libjs-typedarray-to-buffer libllvm19
  libnet-dbus-perl libpciaccess0 libre2-10 libsm6 libssl-dev libtie-ixhash-perl libuv1-dev libvulkan1
  libwayland-client0 libwayland-server0 libx11-protocol-perl libx11-xcb1 libxaw7 libxcb-dri2-0
  libxcb-dri3-0 libxcb-glx0 libxcb-present0 libxcb-randr0 libxcb-shape0 libxcb-shm0 libxcb-sync1
  libxcb-xfixes0 libxcomposite1 libxcursor1 libxfixes3 libxft2 libxi6 libxinerama1 libxkbfile1
  libxml-parser-perl libxml-twig-perl libxml-xpathengine-perl libxmu6 libxrandr2 libxrender1 libxshmfence1
  libxt6t64 libxtst6 libxv1 libxxf86dga1 libxxf86vm1 mesa-libgallium mesa-vulkan-drivers node-abbrev
  node-ampproject-remapping node-ansi-escapes node-ansi-regex node-ansi-styles node-aproba
  node-are-we-there-yet node-argparse node-arrify node-async node-async-each node-auto-bind
  node-babel-plugin-add-module-exports node-babel7-runtime node-balanced-match node-base64-js
  node-binary-extensions node-brace-expansion node-busboy node-camelcase node-caniuse-lite node-chownr
  node-chrome-trace-event node-ci-info node-cjs-module-lexer node-cli-boxes node-cli-cursor node-clone
  node-clone-deep node-collection-visit node-color-convert node-color-name node-colors node-commander
  node-commondir node-concat-stream node-console-control-strings node-convert-source-map node-core-js
  node-core-js-pure node-core-util-is node-data-uri-to-buffer node-decompress-response node-deep-is
  node-defaults node-define-property node-delegates node-depd node-diff node-electron-to-chromium
  node-encoding node-end-of-stream node-err-code node-error-ex node-es-module-lexer
  node-escape-string-regexp node-eslint-utils node-eslint-visitor-keys node-esquery node-estraverse
  node-esutils node-events node-fancy-log node-fast-deep-equal node-fast-levenshtein node-fetch
  node-find-up node-flatted node-for-in node-for-own node-foreground-child node-fs-readdir-recursive
  node-fs-write-stream-atomic node-fs.realpath node-function-bind node-functional-red-black-tree
  node-get-caller-file node-get-stream node-get-value node-glob node-globals node-got node-graceful-fs
  node-growl node-has-flag node-has-unicode node-has-value node-has-values node-hosted-git-info
  node-iconv-lite node-ieee754 node-iferr node-imurmurhash node-indent-string node-inflight node-inherits
  node-ini node-interpret node-ip node-ip-regex node-is-arrayish node-is-binary-path node-is-buffer
  node-is-descriptor node-is-extendable node-is-extglob node-is-path-cwd node-is-plain-obj
  node-is-plain-object node-is-stream node-is-typedarray node-is-windows node-isarray node-isexe
  node-isobject node-js-tokens node-jsesc node-json-buffer node-json-parse-better-errors node-json-schema
  node-json-schema-traverse node-json-stable-stringify node-jsonify node-jsonparse node-kind-of node-levn
  node-loader-runner node-locate-path node-lodash-packages node-log-driver node-lowercase-keys
  node-lru-cache node-map-visit node-memfs node-merge-stream node-mimic-response node-minimatch
  node-minimist node-minipass node-mixin-deep node-mute-stream node-n3 node-negotiator node-neo-async
  node-npm-run-path node-object-inspect node-object-visit node-once node-optimist node-optionator
  node-osenv node-p-cancelable node-p-limit node-p-locate node-p-map node-pascalcase node-path-dirname
  node-path-exists node-path-is-absolute node-path-is-inside node-path-type node-pify node-pkg-dir
  node-postcss-value-parser node-prelude-ls node-process-nextick-args node-promise-inflight
  node-promise-retry node-promzard node-prr node-pump node-punycode node-quick-lru node-randombytes
  node-read node-readable-stream node-rechoir node-regenerate node-regenerate-unicode-properties
  node-regenerator-runtime node-regenerator-transform node-regexpp node-regjsgen node-repeat-string
  node-require-directory node-require-from-string node-resolve node-resolve-cwd node-resolve-from
  node-restore-cursor node-resumer node-retry node-run-queue node-safe-buffer node-sellside-emitter
  node-serialize-javascript node-set-blocking node-set-immediate-shim node-shebang-command
  node-shebang-regex node-shell-quote node-signal-exit node-slash node-slice-ansi node-source-list-map
  node-source-map node-source-map-support node-spdx-correct node-spdx-exceptions node-spdx-expression-parse
  node-spdx-license-ids node-sprintf-js node-ssri node-stack-utils node-string-decoder node-strip-bom
  node-strip-json-comments node-supports-color node-tapable node-terser node-text-table node-through
  node-time-stamp node-to-fast-properties node-tslib node-type-check node-typedarray
  node-typedarray-to-buffer node-undici node-unicode-canonical-property-names-ecmascript
  node-unicode-match-property-value-ecmascript node-unicode-property-aliases-ecmascript
  node-unique-filename node-unset-value node-uri-js node-util-deprecate node-uuid node-v8flags
  node-validate-npm-package-license node-wcwidth.js node-webpack-sources node-wordwrap node-wrappy
  node-write-file-atomic node-xtend node-y18n node-yallist node-yaml x11-common x11-utils x11-xserver-utils
  xdg-utils zutty
Use 'sudo apt autoremove' to remove them.
The following packages will be REMOVED:
  eslint libjs-util libnode-dev libnode109 node-acorn node-agent-base node-ajv node-ajv-keywords
  node-anymatch node-archy node-assert node-babel-helper-define-polyfill-provider node-babel-plugin-lodash
  node-babel-plugin-polyfill-corejs2 node-babel-plugin-polyfill-corejs3
  node-babel-plugin-polyfill-regenerator node-babel7 node-base node-braces node-browserslist node-builtins
  node-cacache node-cache-base node-chalk node-chokidar node-cli-table node-cli-truncate node-cliui
  node-columnify node-copy-concurrently node-core-js-compat node-coveralls node-css-loader
  node-css-selector-tokenizer node-debbundle-es-to-primitive node-debug node-decamelize node-deep-equal
  node-define-properties node-defined node-del node-doctrine node-enhanced-resolve node-errno
  node-es-abstract node-es6-error node-escodegen node-eslint-scope node-espree node-esprima node-esrecurse
  node-file-entry-cache node-fill-range node-find-cache-dir node-flat-cache node-gauge node-glob-parent
  node-globby node-gyp node-http-proxy-agent node-https-proxy-agent node-icss-utils node-ignore
  node-is-glob node-is-number node-is-path-inside node-is-primitive node-istanbul node-jest-debbundle
  node-jest-worker node-js-yaml node-json5 node-lcov-parse node-lodash node-make-dir node-memory-fs
  node-micromatch node-mime node-mime-types node-mkdirp node-move-concurrently node-ms node-nopt
  node-normalize-package-data node-normalize-path node-npm-bundled node-npm-package-arg node-npmlog
  node-object-assign node-opener node-parse-json node-picocolors node-postcss
  node-postcss-modules-extract-imports node-postcss-modules-values node-progress node-re2
  node-read-package-json node-read-pkg node-readdirp node-regexpu-core node-regjsparser node-rimraf
  node-schema-utils node-semver node-set-value node-string-width node-strip-ansi node-tap
  node-tap-mocha-reporter node-tap-parser node-tape node-tar node-to-regex-range
  node-unicode-match-property-ecmascript node-union-value node-util node-v8-compile-cache
  node-validate-npm-package-name node-watchpack node-webassemblyjs node-which node-wide-align
  node-widest-line node-wrap-ansi node-write node-ws node-yargs node-yargs-parser nodejs-doc npm terser
  webpack
The following packages will be upgraded:
  nodejs
1 upgraded, 0 newly installed, 133 to remove and 4 not upgraded.
Need to get 32.0 MB of archives.
After this operation, 82.4 MB of additional disk space will be used.
Get:1 https://deb.nodesource.com/node_20.x nodistro/main amd64 nodejs amd64 20.19.2-1nodesource1 [32.0 MB]
Fetched 32.0 MB in 1s (47.8 MB/s)  
(Reading database ... 159281 files and directories currently installed.)
Removing npm (9.2.0~ds1-2) ...
Removing node-css-loader (6.8.1+~cs14.0.17-1) ...
Removing webpack (5.76.1+dfsg1+~cs17.16.16-1) ...
Removing eslint (6.4.0~dfsg+~6.1.9-11build3) ...
Removing node-tap (16.3.7+ds1+~cs50.9.19-4) ...
Removing node-webassemblyjs (1.11.4+dfsg+~cs10.11.17-2) ...
Removing node-gyp (9.3.0-3) ...
Removing libnode-dev (18.19.1+dfsg-6ubuntu5) ...
Removing nodejs-doc (18.19.1+dfsg-6ubuntu5) ...
Removing node-espree (9.4.1~dfsg-2) ...
Removing terser (5.19.2-1) ...
Removing node-ws (8.11.0+~cs13.7.3-2) ...
Removing node-file-entry-cache (6.0.1+~3.0.4+~2.0.0+~1.0.0+~2.0.1-1) ...
Removing node-flat-cache (3.0.4~6.0.1+~3.0.4+~2.0.0+~1.0.0+~2.0.1-1) ...
Removing node-write (2.0.0~6.0.1+~3.0.4+~2.0.0+~1.0.0+~2.0.1-1) ...
Removing node-v8-compile-cache (2.4.0-2) ...
Removing node-base (3.0.0-3) ...
Removing node-cache-base (4.0.2-1) ...
Removing node-union-value (2.0.1-4) ...
Removing node-jest-debbundle (29.6.2~ds1+~cs73.45.28-5) ...
Removing node-babel-plugin-lodash (3.3.4+~cs2.0.1-7) ...
Removing node-tap-mocha-reporter (5.0.3+~2.0.2-2) ...
Removing node-tap-parser (11.0.2+~cs2.1.4-1) ...
Removing node-npm-package-arg (10.0.0+~3.0.0-2) ...
Removing node-cacache (17.0.3+~cs10.3.7-1) ...
Removing node-move-concurrently (1.0.1-5) ...
Removing node-re2:amd64 (1.20.10+~cs2.13.13-1) ...
Removing node-progress (2.0.3-2) ...
Removing node-postcss-modules-extract-imports (3.0.0-2) ...
Removing node-opener (1.5.2+~1.4.0-1) ...
Removing node-eslint-scope (7.1.1+~3.7.4-1) ...
Removing node-esrecurse (4.3.0-2) ...
Removing node-watchpack (2.4.0+~cs2.8.1-1) ...
Removing node-chokidar (3.6.0-2) ...
Removing node-tar (6.1.13+~cs7.0.5-3) ...
Removing node-mime-types (2.1.35-2) ...
Removing node-mime (3.0.0+dfsg+~cs6.97.2-1) ...
Removing node-coveralls (3.1.1-2build1) ...
Removing node-lcov-parse (1.0.0+20170612git80d039574ed9-6) ...
Removing node-set-value (4.1.0+~4.0.1-2) ...
Removing node-is-primitive (3.0.1-3) ...
Removing node-enhanced-resolve (5.15.0-1) ...
Removing node-memory-fs (0.5.0+~0.3.3-2) ...
Removing node-errno (1.0.0-3) ...
Removing node-doctrine (3.0.0-4) ...
Removing node-css-selector-tokenizer (0.8.0+~cs4.8.3-1) ...
Removing node-jest-worker (29.6.2~ds1+~cs73.45.28-5) ...
Removing node-schema-utils (4.2.0~ds-3build3) ...
Removing node-deep-equal (2.2.3+~cs43.15.94-1) ...
Removing node-tape (5.6.1+~cs8.20.19-1) ...
Removing node-istanbul (0.4.5+repack10+~cs98.25.59-2) ...
Removing node-read-pkg (5.2.0-2) ...
Removing node-parse-json (5.2.0+~cs5.1.7-1) ...
Removing node-assert (2.0.0+~cs3.9.8-2) ...
Removing node-util (0.12.5+~1.0.10-1) ...
Removing libjs-util (0.12.5+~1.0.10-1) ...
Removing node-define-properties (1.2.1+~cs2.2.3-1) ...
Removing node-es-abstract (1.20.4+~cs26.27.47-1) ...
Removing node-debbundle-es-to-primitive (1.2.1+~cs9.7.25-2) ...
Removing node-which (2.0.2+~cs1.3.2-3) ...
Removing node-babel7 (7.20.15+ds1+~cs214.269.168-6build1) ...
Removing node-regexpu-core (5.2.2-3) ...
Removing node-unicode-match-property-ecmascript (2.0.0-2) ...
Removing node-yargs (16.2.0+~16.0.4-7) ...
Removing node-cliui (7.0.4+repack+~cs3.1.0-4) ...
Removing node-wrap-ansi (8.0.1+~8.0.1-3) ...
Removing node-regjsparser (0.9.1+ds-2) ...
Removing node-babel-plugin-polyfill-corejs3 (0.6.0~0~20220913+ds1-1) ...
Removing node-core-js-compat (3.33.2-1build2) ...
Removing node-browserslist (4.22.1+~cs6.1.28-1) ...
Removing node-object-assign (4.1.1-7) ...
Removing node-nopt (5.0.0-4) ...
Removing node-babel-plugin-polyfill-regenerator (0.4.1~0~20220913+ds1-1) ...
Removing node-lodash (4.17.21+dfsg+~cs8.31.198.20210220-9) ...
Removing node-json5 (2.2.3+dfsg-1build1) ...
Removing node-js-yaml (4.1.0+dfsg+~4.0.5-7) ...
Removing node-find-cache-dir (3.3.2+~3.2.1-1) ...
Removing node-del (7.0.0-5) ...
Removing node-is-path-inside (3.0.3-2) ...
Removing node-globby (13.1.3+~cs16.25.40-2) ...
Removing node-micromatch (4.0.5+~4.0.2-1) ...
Removing node-braces (3.0.2+~3.0.1-1) ...
Removing node-fill-range (7.0.1+~7.0.0-1) ...
Removing node-to-regex-range (5.0.1-4) ...
Removing node-is-number (7.0.0-4) ...
Removing node-glob-parent (6.0.2+~5.1.1-2) ...
Removing node-is-glob (4.0.3-2) ...
Removing node-ignore (5.2.1-1) ...
Removing node-escodegen (2.1.0+dfsg+~0.0.8-1) ...
Removing node-esprima (4.0.1+ds+~4.0.3-2) ...
Removing node-es6-error (4.1.1-5) ...
Removing node-defined (1.0.1+~1.0.0-1) ...
Removing node-yargs-parser (21.1.1+~21.0.0-4) ...
Removing node-decamelize (4.0.0-2) ...
Removing node-chalk (5.3.0-1build1) ...
Removing node-archy (1.0.0-6) ...
Removing node-babel-plugin-polyfill-corejs2 (0.3.3~0~20220913+ds1-1) ...
Removing node-babel-helper-define-polyfill-provider (0.3.3~0~20220913+ds1-1) ...
dpkg: node-ajv: dependency problems, but removing anyway as you requested:
 node-ajv-keywords depends on node-ajv (>= 8~).

Removing node-ajv (8.12.0~ds+~2.1.1-4) ...
dpkg: libnode109:amd64: dependency problems, but removing anyway as you requested:
 nodejs depends on libnode109 (= 18.19.1+dfsg-6ubuntu5).

Removing libnode109:amd64 (18.19.1+dfsg-6ubuntu5) ...
dpkg: node-strip-ansi: dependency problems, but removing anyway as you requested:
 node-string-width depends on node-strip-ansi.
 node-gauge depends on node-strip-ansi.
 node-columnify depends on node-strip-ansi.

Removing node-strip-ansi (6.0.1-2) ...
dpkg: node-semver: dependency problems, but removing anyway as you requested:
 node-normalize-package-data depends on node-semver.
 node-make-dir depends on node-semver.
 node-builtins depends on node-semver.

Removing node-semver (7.5.4+~7.5.0-2) ...
dpkg: node-rimraf: dependency problems, but removing anyway as you requested:
 node-copy-concurrently depends on node-rimraf.

Removing node-rimraf (3.0.2-2) ...
dpkg: node-postcss: dependency problems, but removing anyway as you requested:
 node-postcss-modules-values depends on node-postcss (>= 8.1~).
 node-icss-utils depends on node-postcss (>= 8.1~).

Removing node-postcss (8.4.31+~cs8.0.26-1) ...
Removing node-picocolors (1.0.0-4) ...
dpkg: node-normalize-path: dependency problems, but removing anyway as you requested:
 node-anymatch depends on node-normalize-path.

Removing node-normalize-path (3.0.0+~3.0.0-1) ...
dpkg: node-debug: dependency problems, but removing anyway as you requested:
 node-agent-base depends on node-debug.

Removing node-debug (4.3.4+~cs4.1.7-1) ...
Removing node-ms (2.1.3+~cs0.7.31-3) ...
dpkg: node-mkdirp: dependency problems, but removing anyway as you requested:
 node-copy-concurrently depends on node-mkdirp (>= 1).

Removing node-mkdirp (1.0.4+~1.0.2-4) ...
(Reading database ... 144490 files and directories currently installed.)
Preparing to unpack .../nodejs_20.19.2-1nodesource1_amd64.deb ...
Unpacking nodejs (20.19.2-1nodesource1) over (18.19.1+dfsg-6ubuntu5) ...
(Reading database ... 149712 files and directories currently installed.)
Removing node-acorn (8.8.1+ds+~cs25.17.7-2) ...
Removing node-http-proxy-agent (7.0.0~0~2023071921-5) ...
Removing node-https-proxy-agent (7.0.1~0~2023071921-5) ...
Removing node-agent-base (7.1.0~0~2023071921-5) ...
Removing node-ajv-keywords (5.1.0-4) ...
Removing node-readdirp (3.6.0-1) ...
Removing node-anymatch (3.1.3+~cs4.6.1-2) ...
Removing node-validate-npm-package-name (5.0.0+~4.0.0-1) ...
Removing node-builtins (5.0.1-1) ...
Removing node-cli-table (0.3.11+~cs0.13.4-3) ...
Removing node-cli-truncate (2.1.0-5) ...
Removing node-columnify (1.6.0+~1.5.1-1) ...
Removing node-copy-concurrently (1.0.5-9) ...
Removing node-npmlog (7.0.1+~4.1.4-1) ...
Removing node-gauge (4.0.4-2) ...
Removing node-postcss-modules-values (4.0.0+~4.0.0-1) ...
Removing node-icss-utils (5.1.0+~5.1.0-1) ...
Removing node-make-dir (3.1.0-3) ...
Removing node-npm-bundled (2.0.1-2) ...
Removing node-read-package-json (5.0.2+~2.0.0-1) ...
Removing node-normalize-package-data (4.0.1+~2.4.1-1) ...
Removing node-widest-line (3.1.0-2) ...
Removing node-wide-align (1.1.3-4) ...
Removing node-string-width (4.2.3+~cs13.2.3-1) ...
Setting up nodejs (20.19.2-1nodesource1) ...
Processing triggers for libc-bin (2.39-0ubuntu8.4) ...
Processing triggers for man-db (2.12.0-4build2) ...
Scanning processes...                                                                                        
Scanning candidates...                                                                                       
Scanning linux images...                                                                                     

Running kernel seems to be up-to-date.

Restarting services...

Service restarts being deferred:
 /etc/needrestart/restart.d/dbus.service
 systemctl restart docker.service
 systemctl restart systemd-logind.service
 systemctl restart unattended-upgrades.service

No containers need to be restarted.

User sessions running outdated binaries:
 ubuntu @ session #121: login[12882]
 ubuntu @ user manager service: systemd[1516]

No VM guests are running outdated hypervisor (qemu) binaries on this host.
Step 3: Installing PM2...

added 135 packages in 5s

13 packages are looking for funding
  run `npm fund` for details
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.4.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.4.2
npm notice To update run: npm install -g npm@11.4.2
npm notice
Step 4: Cloning repository...
Cloning into 'neta-backspace-fm'...
Username for 'https://github.com': drikin
Password for 'https://drikin@github.com': 
remote: Support for password authentication was removed on August 13, 2021.
remote: Please see https://docs.github.com/get-started/getting-started-with-git/about-remote-repositories#cloning-with-https-urls for information on currently recommended modes of authentication.
fatal: Authentication failed for 'https://github.com/your-username/neta-backspace-fm.git/'
ubuntu@neta:~/Netaspace$ cd ..
ubuntu@neta:~$ ls
Netaspace
ubuntu@neta:~$ ls -al
total 32
drwxr-xr-x 5 ubuntu ubuntu 4096 Jun 13 09:36 .
drwxr-xr-x 3 root   root   4096 Sep 13  2024 ..
-rw------- 1 ubuntu ubuntu  165 Jun 13 05:34 .bash_history
drwx------ 2 ubuntu ubuntu 4096 Jun 13 05:34 .cache
-rw------- 1 ubuntu ubuntu   20 Jun 13 09:34 .lesshst
drwxrwxr-x 7 ubuntu ubuntu 4096 Jun 13 09:34 Netaspace
drwx------ 2 ubuntu ubuntu 4096 Jun 13 07:24 .ssh
-rw-r--r-- 1 ubuntu ubuntu    0 Jun 13 05:34 .sudo_as_admin_successful
-rw------- 1 ubuntu ubuntu 2440 Jun 13 09:27 .viminfo
ubuntu@neta:~$ cd Netaspace/
ubuntu@neta:~/Netaspace$ ls -al
total 596
drwxrwxr-x 7 ubuntu ubuntu   4096 Jun 13 09:34 .
drwxr-xr-x 5 ubuntu ubuntu   4096 Jun 13 09:36 ..
drwxrwxr-x 3 ubuntu ubuntu   4096 Jun 13 07:25 chrome-extension
drwxrwxr-x 3 ubuntu ubuntu   4096 Jun 13 07:25 client
-rw-rw-r-- 1 ubuntu ubuntu    459 Jun 13 07:25 components.json
-rw-rw-r-- 1 ubuntu ubuntu    210 Jun 13 07:25 cookies.txt
-rw-rw-r-- 1 ubuntu ubuntu   2990 Jun 13 09:34 database-setup.sql
-rw-rw-r-- 1 ubuntu ubuntu   3821 Jun 13 09:34 deploy-commands.sh
-rwxrwxr-x 1 ubuntu ubuntu   4571 Jun 13 07:25 deploy-full-production.sh
-rw-rw-r-- 1 ubuntu ubuntu   4817 Jun 13 09:26 DEPLOYMENT_GUIDE.md
-rw-rw-r-- 1 ubuntu ubuntu   1630 Jun 13 07:25 deploy-production.js
-rw-rw-r-- 1 ubuntu ubuntu   1488 Jun 13 09:26 deploy-sakura.sh
-rw-rw-r-- 1 ubuntu ubuntu   1785 Jun 13 09:34 DNS_SETUP.md
-rw-rw-r-- 1 ubuntu ubuntu    182 Jun 13 07:25 .dockerignore
-rw-rw-r-- 1 ubuntu ubuntu    325 Jun 13 07:25 drizzle.config.ts
-rw-rw-r-- 1 ubuntu ubuntu    703 Jun 13 09:34 .env
-rw-rw-r-- 1 ubuntu ubuntu    411 Jun 13 07:25 .env.example
-rw-rw-r-- 1 ubuntu ubuntu    703 Jun 13 09:34 .env.production
drwxrwxr-x 8 ubuntu ubuntu   4096 Jun 13 09:34 .git
-rw-rw-r-- 1 ubuntu ubuntu    130 Jun 13 07:25 .gitignore
-rw-rw-r-- 1 ubuntu ubuntu   1570 Jun 13 09:26 health-check.sh
-rwxrwxr-x 1 ubuntu ubuntu   1423 Jun 13 07:25 monitor-production.sh
-rw-rw-r-- 1 ubuntu ubuntu    395 Jun 13 07:25 neta-app.service
-rw-rw-r-- 1 ubuntu ubuntu   2955 Jun 13 09:34 nginx-config.conf
-rw-rw-r-- 1 ubuntu ubuntu   3920 Jun 13 07:25 package.json
-rw-rw-r-- 1 ubuntu ubuntu 383610 Jun 13 07:25 package-lock.json
-rw-rw-r-- 1 ubuntu ubuntu    477 Jun 13 09:26 pm2.config.js
-rw-rw-r-- 1 ubuntu ubuntu     80 Jun 13 07:25 postcss.config.js
-rw-rw-r-- 1 ubuntu ubuntu    210 Jun 13 07:25 prod_cookies.txt
-rw-rw-r-- 1 ubuntu ubuntu   2132 Jun 13 07:25 production-monitor.sh
-rw-rw-r-- 1 ubuntu ubuntu   6714 Jun 13 07:25 production-server-auth.mjs
-rw-rw-r-- 1 ubuntu ubuntu  12888 Jun 13 07:25 production-server-complete.mjs
-rw-rw-r-- 1 ubuntu ubuntu   6828 Jun 13 07:25 production-server-full.mjs
-rw-rw-r-- 1 ubuntu ubuntu   2842 Jun 13 07:25 production-server.mjs
-rw-rw-r-- 1 ubuntu ubuntu   3372 Jun 13 09:34 quick-deploy.sh
-rw-rw-r-- 1 ubuntu ubuntu   4408 Jun 13 07:25 README.md
-rw-rw-r-- 1 ubuntu ubuntu    751 Jun 13 09:26 .replit
-rw-rw-r-- 1 ubuntu ubuntu   1395 Jun 13 09:34 SAKURA_DEPLOY_COMPLETE.md
drwxrwxr-x 2 ubuntu ubuntu   4096 Jun 13 07:25 server
-rw-rw-r-- 1 ubuntu ubuntu   2223 Jun 13 09:26 server-setup.sh
drwxrwxr-x 2 ubuntu ubuntu   4096 Jun 13 09:26 shared
-rw-rw-r-- 1 ubuntu ubuntu   2787 Jun 13 07:25 tailwind.config.ts
-rw-rw-r-- 1 ubuntu ubuntu    657 Jun 13 07:25 tsconfig.json
-rw-rw-r-- 1 ubuntu ubuntu    894 Jun 13 07:25 vite.config.ts
-rwxrwxr-x 1 ubuntu ubuntu  14928 Jun 13 09:26 zero-deploy.sh
ubuntu@neta:~/Netaspace$ git status
On branch main
Your branch is up to date with 'origin/main'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	.env

nothing added to commit but untracked files present (use "git add" to track)
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 8, done.
remote: Counting objects: 100% (8/8), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 7 (delta 3), reused 7 (delta 3), pack-reused 0 (from 0)
Unpacking objects: 100% (7/7), 3.26 KiB | 1.63 MiB/s, done.
From github.com:drikin/Netaspace
   b169872..4f876e4  main       -> origin/main
Updating b169872..4f876e4
Fast-forward
 UPLOAD_INSTRUCTIONS.md      |  54 ++++++++++++++++++++++++++++
 deploy-bundle.tar.gz.sh     |  25 +++++++++++++
 quick-deploy-from-bundle.sh | 143 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 222 insertions(+)
 create mode 100644 UPLOAD_INSTRUCTIONS.md
 create mode 100644 deploy-bundle.tar.gz.sh
 create mode 100644 quick-deploy-from-bundle.sh
ubuntu@neta:~/Netaspace$ git pull
Already up to date.
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Compressing objects: 100% (7/7), done.
Unpacking objects: 100% (8/8), 6.74 KiB | 3.37 MiB/s, done.
remote: Total 8 (delta 1), reused 8 (delta 1), pack-reused 0 (from 0)
From github.com:drikin/Netaspace
   4f876e4..d115249  main       -> origin/main
Updating 4f876e4..d115249
Fast-forward
 UBUNTU_DEPLOYMENT.md       | 122 +++++++++++++++++++++++++++++++
 deploy.sh                  | 294 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 initial-setup.sh           |  67 +++++++++++++++++
 production-env-template.sh |  35 +++++++++
 systemd-service.sh         |  36 +++++++++
 update.sh                  |  20 +++++
 6 files changed, 574 insertions(+)
 create mode 100644 UBUNTU_DEPLOYMENT.md
 create mode 100644 deploy.sh
 create mode 100644 initial-setup.sh
 create mode 100644 production-env-template.sh
 create mode 100644 systemd-service.sh
 create mode 100644 update.sh
ubuntu@neta:~/Netaspace$ chmod +x deploy.sh production-env-template.sh
ubuntu@neta:~/Netaspace$ ./production-env-template.sh
Environment file created successfully!
Database URL configured for existing Neon PostgreSQL instance
ubuntu@neta:~/Netaspace$ ./deploy.sh --initial
[2025-06-13 11:49:11] Starting deployment for neta.backspace.fm
[2025-06-13 11:49:11] Server: 153.125.147.133
[2025-06-13 11:49:11] Domain: neta.backspace.fm
[2025-06-13 11:49:11] Initial setup: true
[2025-06-13 11:49:11] Pulling latest code from GitHub...
HEAD is now at d115249 Automate deployment process on Ubuntu server for easier updates
Removing .env
[2025-06-13 11:49:13] Installing system dependencies...
Hit:1 https://download.docker.com/linux/ubuntu noble InRelease
Hit:2 https://deb.nodesource.com/node_20.x nodistro InRelease               
Hit:3 http://archive.ubuntu.com/ubuntu noble InRelease                      
Get:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]      
Get:5 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]    
Get:6 http://archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]
Get:7 http://security.ubuntu.com/ubuntu noble-security/main amd64 Components [21.5 kB]
Get:8 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 Components [161 kB]
Get:9 http://archive.ubuntu.com/ubuntu noble-updates/universe amd64 Components [376 kB]
Get:10 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Components [52.2 kB]    
Get:11 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Components [208 B]
Get:12 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Components [208 B]
Get:13 http://archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Components [212 B]
Get:14 http://archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Components [940 B]
Get:15 http://archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [7,080 B]
Get:16 http://archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [16.4 kB]
Get:17 http://archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [216 B]
Get:18 http://archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B]
Fetched 1,015 kB in 3s (377 kB/s)                                           
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
4 packages can be upgraded. Run 'apt list --upgradable' to see them.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Calculating upgrade... Done
The following packages were automatically installed and are no longer required:
  gyp handlebars javascript-common libcares2 libdrm-amdgpu1 libdrm-intel1 libdrm-nouveau2 libdrm-radeon1
  libegl-mesa0 libegl1 libfile-basedir-perl libfile-desktopentry-perl libfile-mimeinfo-perl libgbm1 libgl1
  libgl1-amber-dri libgl1-mesa-dri libglapi-mesa libgles2 libglvnd0 libglx-mesa0 libglx0 libice6
  libio-stringy-perl libipc-system-simple-perl libjs-async libjs-events libjs-inherits libjs-is-typedarray
  libjs-prettify libjs-regenerate libjs-source-map libjs-sprintf-js libjs-typedarray-to-buffer libllvm19
  libnet-dbus-perl libpciaccess0 libre2-10 libsm6 libssl-dev libtie-ixhash-perl libuv1-dev libvulkan1
  libwayland-client0 libwayland-server0 libx11-protocol-perl libx11-xcb1 libxaw7 libxcb-dri2-0
  libxcb-dri3-0 libxcb-glx0 libxcb-present0 libxcb-randr0 libxcb-shape0 libxcb-shm0 libxcb-sync1
  libxcb-xfixes0 libxcomposite1 libxcursor1 libxfixes3 libxft2 libxi6 libxinerama1 libxkbfile1
  libxml-parser-perl libxml-twig-perl libxml-xpathengine-perl libxmu6 libxrandr2 libxrender1 libxshmfence1
  libxt6t64 libxtst6 libxv1 libxxf86dga1 libxxf86vm1 mesa-libgallium mesa-vulkan-drivers node-abbrev
  node-ampproject-remapping node-ansi-escapes node-ansi-regex node-ansi-styles node-aproba
  node-are-we-there-yet node-argparse node-arrify node-async node-async-each node-auto-bind
  node-babel-plugin-add-module-exports node-babel7-runtime node-balanced-match node-base64-js
  node-binary-extensions node-brace-expansion node-busboy node-camelcase node-caniuse-lite node-chownr
  node-chrome-trace-event node-ci-info node-cjs-module-lexer node-cli-boxes node-cli-cursor node-clone
  node-clone-deep node-collection-visit node-color-convert node-color-name node-colors node-commander
  node-commondir node-concat-stream node-console-control-strings node-convert-source-map node-core-js
  node-core-js-pure node-core-util-is node-data-uri-to-buffer node-decompress-response node-deep-is
  node-defaults node-define-property node-delegates node-depd node-diff node-electron-to-chromium
  node-encoding node-end-of-stream node-err-code node-error-ex node-es-module-lexer
  node-escape-string-regexp node-eslint-utils node-eslint-visitor-keys node-esquery node-estraverse
  node-esutils node-events node-fancy-log node-fast-deep-equal node-fast-levenshtein node-fetch
  node-find-up node-flatted node-for-in node-for-own node-foreground-child node-fs-readdir-recursive
  node-fs-write-stream-atomic node-fs.realpath node-function-bind node-functional-red-black-tree
  node-get-caller-file node-get-stream node-get-value node-glob node-globals node-got node-graceful-fs
  node-growl node-has-flag node-has-unicode node-has-value node-has-values node-hosted-git-info
  node-iconv-lite node-ieee754 node-iferr node-imurmurhash node-indent-string node-inflight node-inherits
  node-ini node-interpret node-ip node-ip-regex node-is-arrayish node-is-binary-path node-is-buffer
  node-is-descriptor node-is-extendable node-is-extglob node-is-path-cwd node-is-plain-obj
  node-is-plain-object node-is-stream node-is-typedarray node-is-windows node-isarray node-isexe
  node-isobject node-js-tokens node-jsesc node-json-buffer node-json-parse-better-errors node-json-schema
  node-json-schema-traverse node-json-stable-stringify node-jsonify node-jsonparse node-kind-of node-levn
  node-loader-runner node-locate-path node-lodash-packages node-log-driver node-lowercase-keys
  node-lru-cache node-map-visit node-memfs node-merge-stream node-mimic-response node-minimatch
  node-minimist node-minipass node-mixin-deep node-mute-stream node-n3 node-negotiator node-neo-async
  node-npm-run-path node-object-inspect node-object-visit node-once node-optimist node-optionator
  node-osenv node-p-cancelable node-p-limit node-p-locate node-p-map node-pascalcase node-path-dirname
  node-path-exists node-path-is-absolute node-path-is-inside node-path-type node-pify node-pkg-dir
  node-postcss-value-parser node-prelude-ls node-process-nextick-args node-promise-inflight
  node-promise-retry node-promzard node-prr node-pump node-punycode node-quick-lru node-randombytes
  node-read node-readable-stream node-rechoir node-regenerate node-regenerate-unicode-properties
  node-regenerator-runtime node-regenerator-transform node-regexpp node-regjsgen node-repeat-string
  node-require-directory node-require-from-string node-resolve node-resolve-cwd node-resolve-from
  node-restore-cursor node-resumer node-retry node-run-queue node-safe-buffer node-sellside-emitter
  node-serialize-javascript node-set-blocking node-set-immediate-shim node-shebang-command
  node-shebang-regex node-shell-quote node-signal-exit node-slash node-slice-ansi node-source-list-map
  node-source-map node-source-map-support node-spdx-correct node-spdx-exceptions node-spdx-expression-parse
  node-spdx-license-ids node-sprintf-js node-ssri node-stack-utils node-string-decoder node-strip-bom
  node-strip-json-comments node-supports-color node-tapable node-terser node-text-table node-through
  node-time-stamp node-to-fast-properties node-tslib node-type-check node-typedarray
  node-typedarray-to-buffer node-undici node-unicode-canonical-property-names-ecmascript
  node-unicode-match-property-value-ecmascript node-unicode-property-aliases-ecmascript
  node-unique-filename node-unset-value node-uri-js node-util-deprecate node-uuid node-v8flags
  node-validate-npm-package-license node-wcwidth.js node-webpack-sources node-wordwrap node-wrappy
  node-write-file-atomic node-xtend node-y18n node-yallist node-yaml x11-common x11-utils x11-xserver-utils
  xdg-utils zutty
Use 'sudo apt autoremove' to remove them.
Get another security update through Ubuntu Pro with 'esm-apps' enabled:
  gh
Learn more about Ubuntu Pro at https://ubuntu.com/pro
The following upgrades have been deferred due to phasing:
  ubuntu-drivers-common
The following packages will be upgraded:
  libtraceevent1 libtraceevent1-plugin update-notifier-common
3 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 282 kB of archives.
After this operation, 0 B of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 update-notifier-common all 3.192.68.2 [207 kB]
Get:2 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 libtraceevent1-plugin amd64 1:1.8.2-1ubuntu2.1 [19.9 kB]
Get:3 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 libtraceevent1 amd64 1:1.8.2-1ubuntu2.1 [55.3 kB]
Fetched 282 kB in 2s (132 kB/s)          
(Reading database ... 149076 files and directories currently installed.)
Preparing to unpack .../update-notifier-common_3.192.68.2_all.deb ...
Unpacking update-notifier-common (3.192.68.2) over (3.192.68build3) ...
Preparing to unpack .../libtraceevent1-plugin_1%3a1.8.2-1ubuntu2.1_amd64.deb ...
Unpacking libtraceevent1-plugin:amd64 (1:1.8.2-1ubuntu2.1) over (1:1.8.2-1ubuntu2) ...
Preparing to unpack .../libtraceevent1_1%3a1.8.2-1ubuntu2.1_amd64.deb ...
Unpacking libtraceevent1:amd64 (1:1.8.2-1ubuntu2.1) over (1:1.8.2-1ubuntu2) ...
Setting up update-notifier-common (3.192.68.2) ...
update-notifier-download.service is a disabled or a static unit not running, not starting it.
update-notifier-motd.service is a disabled or a static unit not running, not starting it.
Setting up libtraceevent1:amd64 (1:1.8.2-1ubuntu2.1) ...
Setting up libtraceevent1-plugin:amd64 (1:1.8.2-1ubuntu2.1) ...
Processing triggers for libc-bin (2.39-0ubuntu8.4) ...
Scanning processes...                                                                                        
Scanning candidates...                                                                                       
Scanning linux images...                                                                                     

Running kernel seems to be up-to-date.

Restarting services...

Service restarts being deferred:
 /etc/needrestart/restart.d/dbus.service
 systemctl restart docker.service
 systemctl restart systemd-logind.service
 systemctl restart unattended-upgrades.service

No containers need to be restarted.

User sessions running outdated binaries:
 ubuntu @ session #121: login[12882]
 ubuntu @ user manager service: systemd[1516]

No VM guests are running outdated hypervisor (qemu) binaries on this host.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
nginx is already the newest version (1.24.0-2ubuntu7.3).
curl is already the newest version (8.5.0-2ubuntu10.6).
git is already the newest version (1:2.43.0-1ubuntu7.2).
ufw is already the newest version (0.36.2-6).
ufw set to manually installed.
fail2ban is already the newest version (1.0.2-3ubuntu0.1).
jq is already the newest version (1.7.1-3build1).
jq set to manually installed.
certbot is already the newest version (2.9.0-1).
python3-certbot-nginx is already the newest version (2.9.0-1).
The following packages were automatically installed and are no longer required:
  gyp handlebars javascript-common libcares2 libdrm-amdgpu1 libdrm-intel1 libdrm-nouveau2 libdrm-radeon1
  libegl-mesa0 libegl1 libfile-basedir-perl libfile-desktopentry-perl libfile-mimeinfo-perl libgbm1 libgl1
  libgl1-amber-dri libgl1-mesa-dri libglapi-mesa libgles2 libglvnd0 libglx-mesa0 libglx0 libice6
  libio-stringy-perl libipc-system-simple-perl libjs-async libjs-events libjs-inherits libjs-is-typedarray
  libjs-prettify libjs-regenerate libjs-source-map libjs-sprintf-js libjs-typedarray-to-buffer libllvm19
  libnet-dbus-perl libpciaccess0 libre2-10 libsm6 libssl-dev libtie-ixhash-perl libuv1-dev libvulkan1
  libwayland-client0 libwayland-server0 libx11-protocol-perl libx11-xcb1 libxaw7 libxcb-dri2-0
  libxcb-dri3-0 libxcb-glx0 libxcb-present0 libxcb-randr0 libxcb-shape0 libxcb-shm0 libxcb-sync1
  libxcb-xfixes0 libxcomposite1 libxcursor1 libxfixes3 libxft2 libxi6 libxinerama1 libxkbfile1
  libxml-parser-perl libxml-twig-perl libxml-xpathengine-perl libxmu6 libxrandr2 libxrender1 libxshmfence1
  libxt6t64 libxtst6 libxv1 libxxf86dga1 libxxf86vm1 mesa-libgallium mesa-vulkan-drivers node-abbrev
  node-ampproject-remapping node-ansi-escapes node-ansi-regex node-ansi-styles node-aproba
  node-are-we-there-yet node-argparse node-arrify node-async node-async-each node-auto-bind
  node-babel-plugin-add-module-exports node-babel7-runtime node-balanced-match node-base64-js
  node-binary-extensions node-brace-expansion node-busboy node-camelcase node-caniuse-lite node-chownr
  node-chrome-trace-event node-ci-info node-cjs-module-lexer node-cli-boxes node-cli-cursor node-clone
  node-clone-deep node-collection-visit node-color-convert node-color-name node-colors node-commander
  node-commondir node-concat-stream node-console-control-strings node-convert-source-map node-core-js
  node-core-js-pure node-core-util-is node-data-uri-to-buffer node-decompress-response node-deep-is
  node-defaults node-define-property node-delegates node-depd node-diff node-electron-to-chromium
  node-encoding node-end-of-stream node-err-code node-error-ex node-es-module-lexer
  node-escape-string-regexp node-eslint-utils node-eslint-visitor-keys node-esquery node-estraverse
  node-esutils node-events node-fancy-log node-fast-deep-equal node-fast-levenshtein node-fetch
  node-find-up node-flatted node-for-in node-for-own node-foreground-child node-fs-readdir-recursive
  node-fs-write-stream-atomic node-fs.realpath node-function-bind node-functional-red-black-tree
  node-get-caller-file node-get-stream node-get-value node-glob node-globals node-got node-graceful-fs
  node-growl node-has-flag node-has-unicode node-has-value node-has-values node-hosted-git-info
  node-iconv-lite node-ieee754 node-iferr node-imurmurhash node-indent-string node-inflight node-inherits
  node-ini node-interpret node-ip node-ip-regex node-is-arrayish node-is-binary-path node-is-buffer
  node-is-descriptor node-is-extendable node-is-extglob node-is-path-cwd node-is-plain-obj
  node-is-plain-object node-is-stream node-is-typedarray node-is-windows node-isarray node-isexe
  node-isobject node-js-tokens node-jsesc node-json-buffer node-json-parse-better-errors node-json-schema
  node-json-schema-traverse node-json-stable-stringify node-jsonify node-jsonparse node-kind-of node-levn
  node-loader-runner node-locate-path node-lodash-packages node-log-driver node-lowercase-keys
  node-lru-cache node-map-visit node-memfs node-merge-stream node-mimic-response node-minimatch
  node-minimist node-minipass node-mixin-deep node-mute-stream node-n3 node-negotiator node-neo-async
  node-npm-run-path node-object-inspect node-object-visit node-once node-optimist node-optionator
  node-osenv node-p-cancelable node-p-limit node-p-locate node-p-map node-pascalcase node-path-dirname
  node-path-exists node-path-is-absolute node-path-is-inside node-path-type node-pify node-pkg-dir
  node-postcss-value-parser node-prelude-ls node-process-nextick-args node-promise-inflight
  node-promise-retry node-promzard node-prr node-pump node-punycode node-quick-lru node-randombytes
  node-read node-readable-stream node-rechoir node-regenerate node-regenerate-unicode-properties
  node-regenerator-runtime node-regenerator-transform node-regexpp node-regjsgen node-repeat-string
  node-require-directory node-require-from-string node-resolve node-resolve-cwd node-resolve-from
  node-restore-cursor node-resumer node-retry node-run-queue node-safe-buffer node-sellside-emitter
  node-serialize-javascript node-set-blocking node-set-immediate-shim node-shebang-command
  node-shebang-regex node-shell-quote node-signal-exit node-slash node-slice-ansi node-source-list-map
  node-source-map node-source-map-support node-spdx-correct node-spdx-exceptions node-spdx-expression-parse
  node-spdx-license-ids node-sprintf-js node-ssri node-stack-utils node-string-decoder node-strip-bom
  node-strip-json-comments node-supports-color node-tapable node-terser node-text-table node-through
  node-time-stamp node-to-fast-properties node-tslib node-type-check node-typedarray
  node-typedarray-to-buffer node-undici node-unicode-canonical-property-names-ecmascript
  node-unicode-match-property-value-ecmascript node-unicode-property-aliases-ecmascript
  node-unique-filename node-unset-value node-uri-js node-util-deprecate node-uuid node-v8flags
  node-validate-npm-package-license node-wcwidth.js node-webpack-sources node-wordwrap node-wrappy
  node-write-file-atomic node-xtend node-y18n node-yallist node-yaml x11-common x11-utils x11-xserver-utils
  xdg-utils zutty
Use 'sudo apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
[2025-06-13 11:49:27] Configuring firewall...
Default incoming policy changed to 'deny'
(be sure to update your rules accordingly)
Default outgoing policy changed to 'allow'
(be sure to update your rules accordingly)
Skipping adding existing rule
Skipping adding existing rule (v6)
Rule added
Rule added (v6)
Firewall is active and enabled on system startup
[2025-06-13 11:49:30] Installing Node.js dependencies...
npm warn config production Use `--omit=dev` instead.
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 518 packages, and audited 519 packages in 10s

76 packages are looking for funding
  run `npm fund` for details

1 low severity vulnerability

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.4.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.4.2
npm notice To update run: npm install -g npm@11.4.2
npm notice
[2025-06-13 11:49:40] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

sh: 1: vite: not found
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 7 (delta 3), reused 7 (delta 3), pack-reused 0 (from 0)
Unpacking objects: 100% (7/7), 12.38 KiB | 1.38 MiB/s, done.
From github.com:drikin/Netaspace
   d115249..7be2bc5  main       -> origin/main
Updating d115249..7be2bc5
Fast-forward
 DEPLOYMENT_FIX.md                                                     |  83 ++++
 ...ubuntu-153-125-147-133-Welcome-to--1749782991302_1749782991302.txt | 802 +++++++++++++++++++++++++++++++
 deploy-fix.sh                                                         | 128 +++++
 deploy.sh                                                             |   2 +-
 4 files changed, 1014 insertions(+), 1 deletion(-)
 create mode 100644 DEPLOYMENT_FIX.md
 create mode 100644 attached_assets/Pasted-Last-login-Thu-Jun-12-17-31-13-on-ttys002-koh-dmacm4-ssh-l-ubuntu-153-125-147-133-Welcome-to--1749782991302_1749782991302.txt
 create mode 100644 deploy-fix.sh
ubuntu@neta:~/Netaspace$ sh ./deploy-fix.sh 
[2025-06-13 11:52:59] Installing all dependencies (including dev dependencies)...
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is

added 624 packages, and audited 625 packages in 11s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
[2025-06-13 11:53:10] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.27s

  dist/index.js  43.7kb

⚡ Done in 6ms
[2025-06-13 11:53:15] Setting up environment variables...
./deploy-fix.sh: 26: [[: not found
[2025-06-13 11:53:15] Setting up database...

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
ubuntu@neta:~/Netaspace$ ./deploy.sh
-bash: ./deploy.sh: Permission denied
ubuntu@neta:~/Netaspace$ sh ./deploy.sh 
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 11:53:30] Starting deployment for neta.backspace.fm
-e [2025-06-13 11:53:30] Server: 153.125.147.133
-e [2025-06-13 11:53:30] Domain: neta.backspace.fm
-e [2025-06-13 11:53:30] Initial setup: false
-e [2025-06-13 11:53:30] Pulling latest code from GitHub...
HEAD is now at 7be2bc5 Ensure smooth deployment process and resolve the build failure issue
./deploy.sh: 54: [[: not found
-e [2025-06-13 11:53:32] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 11:53:41] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.26s

  dist/index.js  43.7kb

⚡ Done in 6ms
-e [2025-06-13 11:53:46] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 11:53:46] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 11:53:46] Managing PM2 processes...

                        -------------

__/\\\\\\\\\\\\\____/\\\\____________/\\\\____/\\\\\\\\\_____
 _\/\\\/////////\\\_\/\\\\\\________/\\\\\\__/\\\///////\\\___
  _\/\\\_______\/\\\_\/\\\//\\\____/\\\//\\\_\///______\//\\\__
   _\/\\\\\\\\\\\\\/__\/\\\\///\\\/\\\/_\/\\\___________/\\\/___
    _\/\\\/////////____\/\\\__\///\\\/___\/\\\________/\\\//_____
     _\/\\\_____________\/\\\____\///_____\/\\\_____/\\\//________
      _\/\\\_____________\/\\\_____________\/\\\___/\\\/___________
       _\/\\\_____________\/\\\_____________\/\\\__/\\\\\\\\\\\\\\\_
        _\///______________\///______________\///__\///////////////__


                          Runtime Edition

        PM2 is a Production Process Manager for Node.js applications
                     with a built-in Load Balancer.

                Start and Daemonize any application:
                $ pm2 start app.js

                Load Balance 4 instances of api.js:
                $ pm2 start api.js -i 4

                Monitor in production:
                $ pm2 monitor

                Make pm2 auto-boot at server restart:
                $ pm2 startup

                To go further checkout:
                http://pm2.io/


                        -------------

[PM2] Spawning PM2 daemon with pm2_home=/home/ubuntu/.pm2
[PM2] PM2 Successfully daemonized
-e [2025-06-13 11:53:47] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 42.3mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 11:53:47] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 11:53:47] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 11:53:47] Waiting for application to start...
-e [2025-06-13 11:53:52] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 11:53:52] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 136.3mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
ubuntu@neta:~/Netaspace$ sudo vim /etc/nginx/sites-available/neta.backspace.fm 
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 7, done.
remote: Counting objects: 100% (7/7), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 5 (delta 1), reused 5 (delta 1), pack-reused 0 (from 0)
Unpacking objects: 100% (5/5), 14.23 KiB | 7.12 MiB/s, done.
From github.com:drikin/Netaspace
   7be2bc5..5c04df9  main       -> origin/main
Updating 7be2bc5..5c04df9
Fast-forward
 ...ubuntu-153-125-147-133-Welcome-to--1749783268204_1749783268205.txt | 1022 ++++++++++++++++++++++++++++++
 debug-502.sh                                                          |  126 ++++
 2 files changed, 1148 insertions(+)
 create mode 100644 attached_assets/Pasted-Last-login-Thu-Jun-12-17-31-13-on-ttys002-koh-dmacm4-ssh-l-ubuntu-153-125-147-133-Welcome-to--1749783268204_1749783268205.txt
 create mode 100644 debug-502.sh
ubuntu@neta:~/Netaspace$ sh ./debug-502.sh 
=== Debugging 502 Bad Gateway ===

1. Checking PM2 status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 102.0mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

2. Checking if app responds on localhost:
* Host localhost:5000 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying [::1]:5000...
* connect to ::1 port 5000 from ::1 port 40154 failed: Connection refused
*   Trying 127.0.0.1:5000...
* connect to 127.0.0.1 port 5000 from 127.0.0.1 port 36652 failed: Connection refused
* Failed to connect to localhost port 5000 after 0 ms: Couldn't connect to server

3. Checking Nginx configuration:
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

4. Checking active Nginx sites:
total 8
drwxr-xr-x 2 root root 4096 Jun 13 11:53 .
drwxr-xr-x 8 root root 4096 Jun 10 15:26 ..
lrwxrwxrwx 1 root root   44 Jun 13 11:53 neta.backspace.fm -> /etc/nginx/sites-available/neta.backspace.fm

5. Checking Nginx error logs:
2025/06/13 11:49:45 [error] 581458#581458: *3756 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:3001/", host: "neta.backspace.fm", referrer: "https://replit.com/"
2025/06/13 11:49:46 [error] 581458#581458: *3756 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:3001/", host: "neta.backspace.fm", referrer: "https://replit.com/"
2025/06/13 11:50:17 [error] 581458#581458: *3759 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:3001/", host: "neta.backspace.fm", referrer: "https://replit.com/"
2025/06/13 11:50:17 [error] 581458#581458: *3759 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:3001/", host: "neta.backspace.fm", referrer: "https://replit.com/"
2025/06/13 11:53:39 [error] 581458#581458: *3762 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:3001/", host: "neta.backspace.fm", referrer: "https://replit.com/"

6. Checking app logs:
[TAILING] Tailing last 10 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-out-0.log last 10 lines:
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 10 lines:
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)

^[[A^[[A^[[B^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (5/5), done.
Unpacking objects: 100% (8/8), 4.49 KiB | 2.25 MiB/s, done.
remote: Total 8 (delta 3), reused 8 (delta 3), pack-reused 0 (from 0)
From github.com:drikin/Netaspace
   5c04df9..2f9acfe  main       -> origin/main
Updating 5c04df9..2f9acfe
Fast-forward
 IMMEDIATE_FIX.md                                                      | 68 +++++++++++++++++++++++++++++++
 .../Pasted--1-Checking-PM2-status--1749783408184_1749783408185.txt    | 47 ++++++++++++++++++++++
 ecosystem.config.js                                                   | 24 +++++++++++
 production-fix.sh                                                     | 59 +++++++++++++++++++++++++++
 quick-production-fix.md                                               | 69 ++++++++++++++++++++++++++++++++
 5 files changed, 267 insertions(+)
 create mode 100644 IMMEDIATE_FIX.md
 create mode 100644 attached_assets/Pasted--1-Checking-PM2-status--1749783408184_1749783408185.txt
 create mode 100644 ecosystem.config.js
 create mode 100644 production-fix.sh
 create mode 100644 quick-production-fix.md
ubuntu@neta:~/Netaspace$ sh ./production-fix.sh 
=== Fixing Production Issues ===
1. Setting up environment variables...
2. Fixing Nginx configuration...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
3. Restarting application with proper environment...
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

  error: unknown option `--env-file'

[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
4. Waiting for application to start...
5. Testing application...
✗ App not responding
6. Final status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 3 lines for [neta-app] process (change the value with --lines option)



^C
ubuntu@neta:~/Netaspace$ git pull
Already up to date.
ubuntu@neta:~/Netaspace$ sh ./deploy.sh 
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 11:59:16] Starting deployment for neta.backspace.fm
-e [2025-06-13 11:59:16] Server: 153.125.147.133
-e [2025-06-13 11:59:16] Domain: neta.backspace.fm
-e [2025-06-13 11:59:16] Initial setup: false
-e [2025-06-13 11:59:16] Pulling latest code from GitHub...
HEAD is now at 2f9acfe Resolve critical production issues to bring the platform back online
Removing .env
./deploy.sh: 54: [[: not found
-e [2025-06-13 11:59:18] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 11:59:27] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.15s

  dist/index.js  43.7kb

⚡ Done in 5ms
-e [2025-06-13 11:59:32] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 11:59:32] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 11:59:32] Managing PM2 processes...
-e [2025-06-13 11:59:32] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 41.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 11:59:32] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 11:59:33] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 11:59:33] Waiting for application to start...
-e [2025-06-13 11:59:38] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 11:59:38] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 130.2mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (5/5), done.
Unpacking objects: 100% (7/7), 5.37 KiB | 2.69 MiB/s, done.
remote: Total 7 (delta 2), reused 7 (delta 2), pack-reused 0 (from 0)
From github.com:drikin/Netaspace
   2f9acfe..1030058  main       -> origin/main
Updating 2f9acfe..1030058
Fast-forward
 SAKURA_DEPLOY_COMPLETE.md                                             | 102 +++++++++++++++++-----------
 ...buntu-neta-Netaspace-sh-deploy-sh--1749783587225_1749783587226.txt | 111 +++++++++++++++++++++++++++++++
 final-production-fix.sh                                               |  76 +++++++++++++++++++++
 verify-and-fix.sh                                                     |  55 +++++++++++++++
 4 files changed, 305 insertions(+), 39 deletions(-)
 create mode 100644 attached_assets/Pasted--C-ubuntu-neta-Netaspace-git-pull-Already-up-to-date-ubuntu-neta-Netaspace-sh-deploy-sh--1749783587225_1749783587226.txt
 create mode 100644 final-production-fix.sh
 create mode 100644 verify-and-fix.sh
ubuntu@neta:~/Netaspace$ sh ./verify-and-fix.sh 
=== Verifying Deployment Status ===
1. Testing application health:
✗ App not responding - checking logs...
[TAILING] Tailing last 10 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-out-0.log last 10 lines:
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 10 lines:
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)

^C
ubuntu@neta:~/Netaspace$ sh ./final-production-fix.sh 
=== Final Production Fix ===
Current PM2 status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 96.5mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Testing localhost connection:
✗ App connection failed

Recent app logs:
[TAILING] Tailing last 5 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-out-0.log last 5 lines:
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 5 lines:
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)

^X^C
ubuntu@neta:~/Netaspace$ sh ./deploy.sh 
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 12:01:50] Starting deployment for neta.backspace.fm
-e [2025-06-13 12:01:50] Server: 153.125.147.133
-e [2025-06-13 12:01:50] Domain: neta.backspace.fm
-e [2025-06-13 12:01:50] Initial setup: false
-e [2025-06-13 12:01:50] Pulling latest code from GitHub...
HEAD is now at 1030058 Update deployment guide with configuration and troubleshooting steps
./deploy.sh: 54: [[: not found
-e [2025-06-13 12:01:52] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 12:02:01] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.26s

  dist/index.js  43.7kb

⚡ Done in 6ms
-e [2025-06-13 12:02:05] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 12:02:05] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 12:02:06] Managing PM2 processes...
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
-e [2025-06-13 12:02:06] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 40.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 12:02:06] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 12:02:06] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 12:02:06] Waiting for application to start...
-e [2025-06-13 12:02:11] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 12:02:11] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 131.0mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ sudo tail -f /var/log/nginx/neta.backspace.fm.error.log
2025/06/13 11:59:34 [error] 603399#603399: *3796 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 11:59:34 [error] 603399#603399: *3796 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 11:59:34 [error] 603399#603399: *3796 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:01:57 [error] 603400#603400: *3802 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:01:58 [error] 603400#603400: *3802 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:04 [error] 603401#603401: *3805 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:10 [error] 603792#603792: *3807 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:11 [error] 603793#603793: *3809 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:13 [error] 603793#603793: *3809 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:14 [error] 603793#603793: *3809 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 7, done.
remote: Counting objects: 100% (7/7), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 5 (delta 2), reused 5 (delta 2), pack-reused 0 (from 0)
Unpacking objects: 100% (5/5), 1.96 KiB | 1.96 MiB/s, done.
From github.com:drikin/Netaspace
   1030058..10f4874  main       -> origin/main
Updating 1030058..10f4874
Fast-forward
 ...I-https-neta-backspace-fm-health-u-1749783754601_1749783754602.txt | 15 +++++++
 fix-connection-refused.sh                                             | 70 ++++++++++++++++++++++++++++++++
 2 files changed, 85 insertions(+)
 create mode 100644 attached_assets/Pasted--Update-deployment-git-pull-deploy-sh-Health-check-curl-I-https-neta-backspace-fm-health-u-1749783754601_1749783754602.txt
 create mode 100644 fix-connection-refused.sh
ubuntu@neta:~/Netaspace$ sh ./fix-connection-refused.sh 
=== Fixing Connection Refused Error ===
1. Current PM2 status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 97.1mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

2. Recent application logs:
[TAILING] Tailing last 10 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-out-0.log last 10 lines:
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 10 lines:
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)

cd ~/Netaspace

# Apply the ecosystem config with environment variables
pm2 stop neta-app
pm2 delete neta-app
pm2 start ecosystem.config.js
pm2 save

# Wait for startup
sleep 10

# Verify the fix
netstat -tlnp | grep :5000
curl http://localhost:5000/health
curl -I http://153.125.147.133
^C
ubuntu@neta:~/Netaspace$ cd ~/Netaspace

# Apply the ecosystem config with environment variables
pm2 stop neta-app
pm2 delete neta-app
pm2 start ecosystem.config.js
pm2 save

# Wait for startup
sleep 10

# Verify the fix
netstat -tlnp | grep :5000
curl http://localhost:5000/health
curl -I http://153.125.147.133
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined
    at file:///home/ubuntu/Netaspace/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:387:35)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:323:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1371:24)
    at Module._compile (node:internal/modules/cjs/loader:1511:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1572:16)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Module.require (node:internal/modules/cjs/loader:1298:19)
    at require (node:internal/modules/helpers:182:18)
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
^X^C
curl: (7) Failed to connect to localhost port 5000 after 0 ms: Couldn't connect to server
HTTP/1.1 301 Moved Permanently
Server: nginx/1.24.0 (Ubuntu)
Date: Fri, 13 Jun 2025 03:05:00 GMT
Content-Type: text/html
Content-Length: 178
Connection: keep-alive
Location: https://neta.backspace.fm/

ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 5, done.
remote: Counting objects: 100% (5/5), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 1), reused 4 (delta 1), pack-reused 0 (from 0)
Unpacking objects: 100% (4/4), 1.56 KiB | 1.56 MiB/s, done.
From github.com:drikin/Netaspace
   10f4874..af581f5  main       -> origin/main
Updating 10f4874..af581f5
Fast-forward
 PRODUCTION_RESOLUTION.md | 40 ++++++++++++++++++++++++++++++++++++++++
 complete-fix-commands.sh | 42 ++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 82 insertions(+)
 create mode 100644 PRODUCTION_RESOLUTION.md
 create mode 100644 complete-fix-commands.sh
ubuntu@neta:~/Netaspace$ sh ./deploy
sh: 0: cannot open ./deploy: No such file
ubuntu@neta:~/Netaspace$ sh ./deploy.sh
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 12:05:23] Starting deployment for neta.backspace.fm
-e [2025-06-13 12:05:23] Server: 153.125.147.133
-e [2025-06-13 12:05:23] Domain: neta.backspace.fm
-e [2025-06-13 12:05:23] Initial setup: false
-e [2025-06-13 12:05:23] Pulling latest code from GitHub...
HEAD is now at af581f5 Add instructions to resolve database connection issues and restore service
./deploy.sh: 54: [[: not found
-e [2025-06-13 12:05:26] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 12:05:35] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.22s

  dist/index.js  43.7kb

⚡ Done in 6ms
-e [2025-06-13 12:05:39] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 12:05:39] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 12:05:40] Managing PM2 processes...
-e [2025-06-13 12:05:40] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 41.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 12:05:40] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 12:05:40] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 12:05:40] Waiting for application to start...
-e [2025-06-13 12:05:45] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 12:05:45] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 130.0mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ sudo tail -f /var/log/nginx/neta.backspace.fm.error.log
2025/06/13 12:01:57 [error] 603400#603400: *3802 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:01:58 [error] 603400#603400: *3802 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:04 [error] 603401#603401: *3805 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:10 [error] 603792#603792: *3807 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:11 [error] 603793#603793: *3809 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:13 [error] 603793#603793: *3809 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:02:14 [error] 603793#603793: *3809 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:04:54 [error] 603795#603795: *3813 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:05:47 [error] 604202#604202: *3816 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:05:48 [error] 604202#604202: *3816 connect() failed (111: Connection refused) while connecting to upstream, client: 69.36.134.42, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:14:14 [error] 604203#604203: *3821 connect() failed (111: Connection refused) while connecting to upstream, client: 104.167.221.114, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm", referrer: "http://153.125.147.133:80"
2025/06/13 12:18:52 [error] 604207#604207: *3826 connect() failed (111: Connection refused) while connecting to upstream, client: 196.251.84.199, server: neta.backspace.fm, request: "GET /.env HTTP/1.1", upstream: "http://127.0.0.1:5000/.env", host: "153.125.147.133"
2025/06/13 12:19:05 [error] 604209#604209: *3828 connect() failed (111: Connection refused) while connecting to upstream, client: 196.251.70.76, server: neta.backspace.fm, request: "GET /.env HTTP/1.1", upstream: "http://127.0.0.1:5000/.env", host: "153.125.147.133"
2025/06/13 12:39:56 [error] 604213#604213: *3832 connect() failed (111: Connection refused) while connecting to upstream, client: 123.225.242.133, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 12:39:56 [error] 604213#604213: *3832 connect() failed (111: Connection refused) while connecting to upstream, client: 123.225.242.133, server: neta.backspace.fm, request: "GET /favicon.ico HTTP/2.0", upstream: "http://127.0.0.1:5000/favicon.ico", host: "neta.backspace.fm", referrer: "https://neta.backspace.fm/"
2025/06/13 13:01:45 [error] 604217#604217: *3839 connect() failed (111: Connection refused) while connecting to upstream, client: 204.76.203.208, server: neta.backspace.fm, request: "PROPFIND / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "153.125.147.133:443"
2025/06/13 13:07:19 [error] 604218#604218: *3841 connect() failed (111: Connection refused) while connecting to upstream, client: 203.138.188.37, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 13:07:19 [error] 604218#604218: *3841 connect() failed (111: Connection refused) while connecting to upstream, client: 203.138.188.37, server: neta.backspace.fm, request: "GET /favicon.ico HTTP/2.0", upstream: "http://127.0.0.1:5000/favicon.ico", host: "neta.backspace.fm", referrer: "https://neta.backspace.fm/"
2025/06/13 13:08:19 [error] 604221#604221: *3846 connect() failed (111: Connection refused) while connecting to upstream, client: 203.138.188.37, server: neta.backspace.fm, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:5000/", host: "neta.backspace.fm"
2025/06/13 13:08:20 [error] 604221#604221: *3846 connect() failed (111: Connection refused) while connecting to upstream, client: 203.138.188.37, server: neta.backspace.fm, request: "GET /favicon.ico HTTP/2.0", upstream: "http://127.0.0.1:5000/favicon.ico", host: "neta.backspace.fm", referrer: "https://neta.backspace.fm/"
^C
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
pm2 stop neta-app
pm2 delete neta-app  
pm2 start ecosystem.config.js
pm2 save
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined
    at file:///home/ubuntu/Netaspace/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:387:35)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:323:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1371:24)
    at Module._compile (node:internal/modules/cjs/loader:1511:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1572:16)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Module.require (node:internal/modules/cjs/loader:1298:19)
    at require (node:internal/modules/helpers:182:18)
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
ubuntu@neta:~/Netaspace$ sh ./deploy.sh
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 13:24:13] Starting deployment for neta.backspace.fm
-e [2025-06-13 13:24:13] Server: 153.125.147.133
-e [2025-06-13 13:24:13] Domain: neta.backspace.fm
-e [2025-06-13 13:24:13] Initial setup: false
-e [2025-06-13 13:24:13] Pulling latest code from GitHub...
HEAD is now at af581f5 Add instructions to resolve database connection issues and restore service
./deploy.sh: 54: [[: not found
-e [2025-06-13 13:24:15] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 13:24:24] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.23s

  dist/index.js  43.7kb

⚡ Done in 6ms
-e [2025-06-13 13:24:28] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 13:24:28] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 13:24:29] Managing PM2 processes...
-e [2025-06-13 13:24:29] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 41.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 13:24:29] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 13:24:29] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 13:24:29] Waiting for application to start...
-e [2025-06-13 13:24:34] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 13:24:34] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 138.3mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ curl -I https://neta.backspace.fm/health
HTTP/2 502 
server: nginx/1.24.0 (Ubuntu)
date: Fri, 13 Jun 2025 04:25:02 GMT
content-type: text/html
content-length: 166
strict-transport-security: max-age=31536000; includeSubDomains

ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 8 (delta 2), reused 8 (delta 2), pack-reused 0 (from 0)
Unpacking objects: 100% (8/8), 3.21 KiB | 1.61 MiB/s, done.
From github.com:drikin/Netaspace
   af581f5..12570c9  main       -> origin/main
Updating af581f5..12570c9
Fast-forward
 CRITICAL_FIX_COMMANDS.md                                              | 29 +++++++++++++
 apply-ecosystem-fix.md                                                | 16 ++++++++
 ...53-125-147-133-redirects-to-HTTPS--1749783968011_1749783968011.txt | 24 +++++++++++
 execute-final-fix.sh                                                  | 70 ++++++++++++++++++++++++++++++++
 immediate-production-fix.sh                                           | 35 ++++++++++++++++
 5 files changed, 174 insertions(+)
 create mode 100644 CRITICAL_FIX_COMMANDS.md
 create mode 100644 apply-ecosystem-fix.md
 create mode 100644 attached_assets/Pasted-Access-URLs-HTTPS-https-neta-backspace-fm-HTTP-http-153-125-147-133-redirects-to-HTTPS--1749783968011_1749783968011.txt
 create mode 100644 execute-final-fix.sh
 create mode 100644 immediate-production-fix.sh
ubuntu@neta:~/Netaspace$ cd ~/Netaspace

# 現在の状態確認
pm2 status
pm2 logs neta-app --lines 5

# ecosystem.config.js で再起動（DATABASE_URL を含む）
pm2 stop neta-app
pm2 delete neta-app
pm2 start ecosystem.config.js
pm2 save

# 起動待機
sleep 10

# 確認
netstat -tlnp | grep :5000
curl http://localhost:5000/health
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 105.0mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 5 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-out-0.log last 5 lines:
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 5 lines:
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)

^C
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined
    at file:///home/ubuntu/Netaspace/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:387:35)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:323:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1371:24)
    at Module._compile (node:internal/modules/cjs/loader:1511:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1572:16)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Module.require (node:internal/modules/cjs/loader:1298:19)
    at require (node:internal/modules/helpers:182:18)
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
^C
Command 'netstat' not found, but can be installed with:
sudo apt install net-tools
curl: (7) Failed to connect to localhost port 5000 after 0 ms: Couldn't connect to server
ubuntu@neta:~/Netaspace$ cd ~/Netaspace

# Stop current process
pm2 stop neta-app
pm2 delete neta-app

# Start with direct environment variables
DATABASE_URL='postgresql://neondb_owner:npg_GFeXV6cr7anp@ep-hidden-thunder-a65mlh9x.us-west-2.aws.neon.tech/neondb?sslmode=require' \
NODE_ENV=production \
PORT=5000 \
SESSION_SECRET='neta-backspace-fm-super-secret-session-key-2025' \
HOST='0.0.0.0' \
pm2 start dist/index.js --name neta-app

pm2 save

# Wait and verify
sleep 8
netstat -tlnp | grep :5000
curl http://localhost:5000/health
curl -I https://neta.backspace.fm/health
[PM2][ERROR] Process or Namespace neta-app not found
[PM2][ERROR] Process or Namespace neta-app not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 0    │ online    │ 0%       │ 18.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2

Command 'netstat' not found, but can be installed with:
sudo apt install net-tools
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>ポッドキャスト用ネタ帳 | backspace.fm</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script type="module" crossorigin src="/assets/index-D7cqMrFt.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-CU4f6s9j.css">
  </head>
  <body>
    <div id="root"></div>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>
HTTP/2 200 
server: nginx/1.24.0 (Ubuntu)
date: Fri, 13 Jun 2025 04:33:27 GMT
content-type: text/html; charset=UTF-8
content-length: 914
x-powered-by: Express
x-content-type-options: nosniff
x-frame-options: DENY
x-xss-protection: 1; mode=block
cache-control: no-cache, no-store, must-revalidate
accept-ranges: bytes
last-modified: Fri, 13 Jun 2025 04:24:28 GMT
etag: W/"392-197678832cc"
x-frame-options: DENY
x-content-type-options: nosniff
x-xss-protection: 1; mode=block
strict-transport-security: max-age=31536000; includeSubDomains

ubuntu@neta:~/Netaspace$ 
ubuntu@neta:~/Netaspace$ df
Filesystem     1K-blocks    Used Available Use% Mounted on
tmpfs           12364148    1100  12363048   1% /run
/dev/vda2       20463316 5428400  13970112  28% /
tmpfs           61820732       0  61820732   0% /dev/shm
tmpfs               5120       0      5120   0% /run/lock
tmpfs           12364144       8  12364136   1% /run/user/1000
ubuntu@neta:~/Netaspace$ top

top - 13:38:53 up 4 days, 21:18,  2 users,  load average: 0.00, 0.00, 0.00
Tasks: 486 total,   1 running, 485 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st 
MiB Mem : 120743.6 total, 115120.5 free,   2042.3 used,   4747.6 buff/cache     
MiB Swap:      0.0 total,      0.0 free,      0.0 used. 118701.3 avail Mem 

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                              
 604939 ubuntu    20   0   12036   5888   3584 R   0.3   0.0   0:00.04 top                                  
      1 root      20   0   22376  13056   9472 S   0.0   0.0   0:43.48 systemd                              
      2 root      20   0       0      0      0 S   0.0   0.0   0:00.91 kthreadd                             
      3 root      20   0       0      0      0 S   0.0   0.0   0:00.00 pool_workqueue_release               
      4 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/R-rcu_g                      
      5 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/R-rcu_p                      
      6 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/R-slub_                      
      7 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/R-netns                      
      9 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/0:0H-events_highpri          
     12 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/R-mm_pe                      
     13 root      20   0       0      0      0 I   0.0   0.0   0:00.00 rcu_tasks_kthread                    
     14 root      20   0       0      0      0 I   0.0   0.0   0:00.00 rcu_tasks_rude_kthread               
     15 root      20   0       0      0      0 I   0.0   0.0   0:00.00 rcu_tasks_trace_kthread              
     16 root      20   0       0      0      0 S   0.0   0.0   0:00.20 ksoftirqd/0                          
     17 root      20   0       0      0      0 I   0.0   0.0   0:24.02 rcu_preempt                          
     18 root      rt   0       0      0      0 S   0.0   0.0   0:02.59 migration/0                          
     19 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/0                        
     20 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/0                              
     21 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/1                              
     22 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/1                        
     23 root      rt   0       0      0      0 S   0.0   0.0   0:03.08 migration/1                          
     24 root      20   0       0      0      0 S   0.0   0.0   0:00.50 ksoftirqd/1                          
     26 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/1:0H-events_highpri          
     27 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/2                              
     28 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/2                        
     29 root      rt   0       0      0      0 S   0.0   0.0   0:02.87 migration/2                          
     30 root      20   0       0      0      0 S   0.0   0.0   0:00.40 ksoftirqd/2                          
     32 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/2:0H-events_highpri          
     33 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/3                              
     34 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/3                        
     35 root      rt   0       0      0      0 S   0.0   0.0   0:02.62 migration/3                          
     36 root      20   0       0      0      0 S   0.0   0.0   0:00.27 ksoftirqd/3                          
     38 root       0 -20       0      0      0 I   0.0   0.0   0:01.39 kworker/3:0H-kblockd                 
     39 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/4                              
     40 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/4                        
     41 root      rt   0       0      0      0 S   0.0   0.0   0:02.75 migration/4                          
     42 root      20   0       0      0      0 S   0.0   0.0   0:00.20 ksoftirqd/4                          
     44 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/4:0H-events_highpri          
     45 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/5                              
     46 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/5                        
     47 root      rt   0       0      0      0 S   0.0   0.0   0:02.88 migration/5                          
     48 root      20   0       0      0      0 S   0.0   0.0   0:00.20 ksoftirqd/5                          
     50 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/5:0H-events_highpri          
     51 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/6                              
     52 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/6                        
     53 root      rt   0       0      0      0 S   0.0   0.0   0:02.69 migration/6                          
     54 root      20   0       0      0      0 S   0.0   0.0   0:00.18 ksoftirqd/6                          
     56 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/6:0H-events_highpri          
     57 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/7                              
     58 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/7                        
     59 root      rt   0       0      0      0 S   0.0   0.0   0:02.67 migration/7                          
     60 root      20   0       0      0      0 S   0.0   0.0   0:00.16 ksoftirqd/7                          
     62 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/7:0H-events_highpri          
     63 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/8                              
     64 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/8                        
     65 root      rt   0       0      0      0 S   0.0   0.0   0:02.67 migration/8                          
     66 root      20   0       0      0      0 S   0.0   0.0   0:00.18 ksoftirqd/8                          
     68 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/8:0H-events_highpri          
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 23, done.
remote: Counting objects: 100% (23/23), done.
remote: Compressing objects: 100% (11/11), done.
remote: Total 20 (delta 9), reused 20 (delta 9), pack-reused 0 (from 0)
Unpacking objects: 100% (20/20), 7.60 KiB | 1.27 MiB/s, done.
From github.com:drikin/Netaspace
   12570c9..a1c641d  main       -> origin/main
Updating 12570c9..a1c641d
Fast-forward
 apply-db-indexes.sh            | 37 +++++++++++++++++++++++++++++++++++++
 db-performance-analysis.sh     | 56 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 db-performance-optimization.md | 59 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 direct-env-fix.sh              | 24 ++++++++++++++++++++++++
 performance-indexes.sql        | 13 +++++++++++++
 performance-optimization.sql   | 29 +++++++++++++++++++++++++++++
 performance-summary.md         | 42 ++++++++++++++++++++++++++++++++++++++++++
 pm2-env-fix.sh                 | 47 +++++++++++++++++++++++++++++++++++++++++++++++
 server/storage.ts              |  9 ++++++---
 9 files changed, 313 insertions(+), 3 deletions(-)
 create mode 100644 apply-db-indexes.sh
 create mode 100644 db-performance-analysis.sh
 create mode 100644 db-performance-optimization.md
 create mode 100644 direct-env-fix.sh
 create mode 100644 performance-indexes.sql
 create mode 100644 performance-optimization.sql
 create mode 100644 performance-summary.md
 create mode 100644 pm2-env-fix.sh
ubuntu@neta:~/Netaspace$ sh ./deploy
sh: 0: cannot open ./deploy: No such file
ubuntu@neta:~/Netaspace$ sh ./deploy.sh
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 13:44:31] Starting deployment for neta.backspace.fm
-e [2025-06-13 13:44:31] Server: 153.125.147.133
-e [2025-06-13 13:44:31] Domain: neta.backspace.fm
-e [2025-06-13 13:44:31] Initial setup: false
-e [2025-06-13 13:44:31] Pulling latest code from GitHub...
HEAD is now at a1c641d Improve database performance by adding indexes and analyzing tables
./deploy.sh: 54: [[: not found
-e [2025-06-13 13:44:33] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 13:44:42] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.17s

  dist/index.js  43.7kb

⚡ Done in 6ms
-e [2025-06-13 13:44:47] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 13:44:47] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 13:44:47] Managing PM2 processes...
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
-e [2025-06-13 13:44:47] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 40.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 13:44:48] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 13:44:48] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 13:44:48] Waiting for application to start...
-e [2025-06-13 13:44:53] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 13:44:53] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 130.9mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$  curl -I https://neta.backspace.fm/health
HTTP/2 502 
server: nginx/1.24.0 (Ubuntu)
date: Fri, 13 Jun 2025 04:45:37 GMT
content-type: text/html
content-length: 166
strict-transport-security: max-age=31536000; includeSubDomains

ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 5, done.
remote: Counting objects: 100% (5/5), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 3 (delta 1), reused 3 (delta 1), pack-reused 0 (from 0)
Unpacking objects: 100% (3/3), 1.03 KiB | 1.03 MiB/s, done.
From github.com:drikin/Netaspace
   a1c641d..4977ad3  main       -> origin/main
Updating a1c641d..4977ad3
Fast-forward
 immediate-production-fix.sh | 64 +++++++++++++++++++++++++++++++++-------------------------------
 1 file changed, 33 insertions(+), 31 deletions(-)
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
chmod +x immediate-production-fix.sh
./immediate-production-fix.sh
=== Immediate Production Fix - 502 Error Resolution ===
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [neta-app](0) ✓
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.17s

  dist/index.js  43.7kb

⚡ Done in 5ms
[PM2] Spawning PM2 daemon with pm2_home=/home/ubuntu/.pm2
[PM2] PM2 Successfully daemonized
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined
    at file:///home/ubuntu/Netaspace/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:387:35)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:323:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1371:24)
    at Module._compile (node:internal/modules/cjs/loader:1511:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1572:16)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Module.require (node:internal/modules/cjs/loader:1298:19)
    at require (node:internal/modules/helpers:182:18)
Application restarted with explicit environment variables

Checking status...
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 10 lines for [all] processes (change the value with --lines option)
/home/ubuntu/.pm2/pm2.log last 10 lines:
PM2        | 2025-06-13T13:47:03: PM2 log: PM2 PID file         : /home/ubuntu/.pm2/pm2.pid
PM2        | 2025-06-13T13:47:03: PM2 log: RPC socket file      : /home/ubuntu/.pm2/rpc.sock
PM2        | 2025-06-13T13:47:03: PM2 log: BUS socket file      : /home/ubuntu/.pm2/pub.sock
PM2        | 2025-06-13T13:47:03: PM2 log: Application log path : /home/ubuntu/.pm2/logs
PM2        | 2025-06-13T13:47:03: PM2 log: Worker Interval      : 30000
PM2        | 2025-06-13T13:47:03: PM2 log: Process dump file    : /home/ubuntu/.pm2/dump.pm2
PM2        | 2025-06-13T13:47:03: PM2 log: Concurrent actions   : 2
PM2        | 2025-06-13T13:47:03: PM2 log: SIGTERM timeout      : 1600
PM2        | 2025-06-13T13:47:03: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:47:03: PM2 log: ===============================================================================






^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 6 (delta 3), reused 6 (delta 3), pack-reused 0 (from 0)
Unpacking objects: 100% (6/6), 2.39 KiB | 2.39 MiB/s, done.
From github.com:drikin/Netaspace
   4977ad3..4597a68  main       -> origin/main
Updating 4977ad3..4597a68
Fast-forward
 ...ed-rest-express-1-0-0-build-vite-b-1749790044378_1749790044379.txt | 61 ++++++++++++++++++++++++++++++++
 ecosystem.config.js                                                   |  5 ++-
 production-restart.sh                                                 | 22 ++++++++++++
 3 files changed, 85 insertions(+), 3 deletions(-)
 create mode 100644 attached_assets/Pasted--PM2-v-All-Applications-Stopped-PM2-v-PM2-Daemon-Stopped-rest-express-1-0-0-build-vite-b-1749790044378_1749790044379.txt
 create mode 100644 production-restart.sh
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
chmod +x production-restart.sh
./production-restart.sh
=== Production Restart - Fixed Ecosystem Config ===
[PM2][WARN] No process found
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped
[PM2] Spawning PM2 daemon with pm2_home=/home/ubuntu/.pm2
[PM2] PM2 Successfully daemonized
[PM2][WARN] Applications  not running, starting...
[PM2][ERROR] Error: No script path - aborting
Application started with corrected configuration

Checking status...
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [all] processes (change the value with --lines option)
/home/ubuntu/.pm2/pm2.log last 20 lines:
PM2        | 2025-06-13T13:47:03: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:47:03: PM2 log: ===============================================================================
PM2        | 2025-06-13T13:48:18: PM2 log: PM2 successfully stopped
PM2        | 2025-06-13T13:48:19: PM2 log: ===============================================================================
PM2        | 2025-06-13T13:48:19: PM2 log: --- New PM2 Daemon started ----------------------------------------------------
PM2        | 2025-06-13T13:48:19: PM2 log: Time                 : Fri Jun 13 2025 13:48:19 GMT+0900 (Japan Standard Time)
PM2        | 2025-06-13T13:48:19: PM2 log: PM2 version          : 6.0.8
PM2        | 2025-06-13T13:48:19: PM2 log: Node.js version      : 20.19.2
PM2        | 2025-06-13T13:48:19: PM2 log: Current arch         : x64
PM2        | 2025-06-13T13:48:19: PM2 log: PM2 home             : /home/ubuntu/.pm2
PM2        | 2025-06-13T13:48:19: PM2 log: PM2 PID file         : /home/ubuntu/.pm2/pm2.pid
PM2        | 2025-06-13T13:48:19: PM2 log: RPC socket file      : /home/ubuntu/.pm2/rpc.sock
PM2        | 2025-06-13T13:48:19: PM2 log: BUS socket file      : /home/ubuntu/.pm2/pub.sock
PM2        | 2025-06-13T13:48:19: PM2 log: Application log path : /home/ubuntu/.pm2/logs
PM2        | 2025-06-13T13:48:19: PM2 log: Worker Interval      : 30000
PM2        | 2025-06-13T13:48:19: PM2 log: Process dump file    : /home/ubuntu/.pm2/dump.pm2
PM2        | 2025-06-13T13:48:19: PM2 log: Concurrent actions   : 2
PM2        | 2025-06-13T13:48:19: PM2 log: SIGTERM timeout      : 1600
PM2        | 2025-06-13T13:48:19: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:48:19: PM2 log: ===============================================================================




^C
ubuntu@neta:~/Netaspace$ ./production-restart.sh
=== Production Restart - Fixed Ecosystem Config ===
[PM2][WARN] No process found
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped
[PM2] Spawning PM2 daemon with pm2_home=/home/ubuntu/.pm2
[PM2] PM2 Successfully daemonized
[PM2][WARN] Applications  not running, starting...
[PM2][ERROR] Error: No script path - aborting
Application started with corrected configuration

Checking status...
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [all] processes (change the value with --lines option)
/home/ubuntu/.pm2/pm2.log last 20 lines:
PM2        | 2025-06-13T13:48:19: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:48:19: PM2 log: ===============================================================================
PM2        | 2025-06-13T13:48:43: PM2 log: PM2 successfully stopped
PM2        | 2025-06-13T13:48:43: PM2 log: ===============================================================================
PM2        | 2025-06-13T13:48:43: PM2 log: --- New PM2 Daemon started ----------------------------------------------------
PM2        | 2025-06-13T13:48:43: PM2 log: Time                 : Fri Jun 13 2025 13:48:43 GMT+0900 (Japan Standard Time)
PM2        | 2025-06-13T13:48:43: PM2 log: PM2 version          : 6.0.8
PM2        | 2025-06-13T13:48:43: PM2 log: Node.js version      : 20.19.2
PM2        | 2025-06-13T13:48:43: PM2 log: Current arch         : x64
PM2        | 2025-06-13T13:48:43: PM2 log: PM2 home             : /home/ubuntu/.pm2
PM2        | 2025-06-13T13:48:43: PM2 log: PM2 PID file         : /home/ubuntu/.pm2/pm2.pid
PM2        | 2025-06-13T13:48:43: PM2 log: RPC socket file      : /home/ubuntu/.pm2/rpc.sock
PM2        | 2025-06-13T13:48:43: PM2 log: BUS socket file      : /home/ubuntu/.pm2/pub.sock
PM2        | 2025-06-13T13:48:43: PM2 log: Application log path : /home/ubuntu/.pm2/logs
PM2        | 2025-06-13T13:48:43: PM2 log: Worker Interval      : 30000
PM2        | 2025-06-13T13:48:43: PM2 log: Process dump file    : /home/ubuntu/.pm2/dump.pm2
PM2        | 2025-06-13T13:48:43: PM2 log: Concurrent actions   : 2
PM2        | 2025-06-13T13:48:43: PM2 log: SIGTERM timeout      : 1600
PM2        | 2025-06-13T13:48:43: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:48:43: PM2 log: ===============================================================================

^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 6 (delta 3), reused 6 (delta 3), pack-reused 0 (from 0)
Unpacking objects: 100% (6/6), 2.14 KiB | 2.14 MiB/s, done.
From github.com:drikin/Netaspace
   4597a68..e716902  main       -> origin/main
Updating 4597a68..e716902
Fast-forward
 ...on-Restart-Fixed-Ecosystem-Config--1749790133356_1749790133356.txt | 40 ++++++++++++++++++++++++++++++++
 direct-start.sh                                                       | 38 ++++++++++++++++++++++++++++++
 ecosystem.config.js                                                   |  2 +-
 3 files changed, 79 insertions(+), 1 deletion(-)
 create mode 100644 attached_assets/Pasted--C-ubuntu-neta-Netaspace-production-restart-sh-Production-Restart-Fixed-Ecosystem-Config--1749790133356_1749790133356.txt
 create mode 100644 direct-start.sh
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
chmod +x direct-start.sh
./direct-start.sh
=== Direct PM2 Start - Production Fix ===
[PM2][WARN] No process found
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped
[PM2] Spawning PM2 daemon with pm2_home=/home/ubuntu/.pm2
[PM2] PM2 Successfully daemonized

  error: unknown option `--exec-mode'

Application started directly with PM2

Checking status...
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 10 lines for [all] processes (change the value with --lines option)
/home/ubuntu/.pm2/pm2.log last 10 lines:
PM2        | 2025-06-13T13:50:02: PM2 log: PM2 PID file         : /home/ubuntu/.pm2/pm2.pid
PM2        | 2025-06-13T13:50:02: PM2 log: RPC socket file      : /home/ubuntu/.pm2/rpc.sock
PM2        | 2025-06-13T13:50:02: PM2 log: BUS socket file      : /home/ubuntu/.pm2/pub.sock
PM2        | 2025-06-13T13:50:02: PM2 log: Application log path : /home/ubuntu/.pm2/logs
PM2        | 2025-06-13T13:50:02: PM2 log: Worker Interval      : 30000
PM2        | 2025-06-13T13:50:02: PM2 log: Process dump file    : /home/ubuntu/.pm2/dump.pm2
PM2        | 2025-06-13T13:50:02: PM2 log: Concurrent actions   : 2
PM2        | 2025-06-13T13:50:02: PM2 log: SIGTERM timeout      : 1600
PM2        | 2025-06-13T13:50:02: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:50:02: PM2 log: ===============================================================================








ç^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 6, done.
remote: Counting objects: 100% (6/6), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 1), reused 4 (delta 1), pack-reused 0 (from 0)
Unpacking objects: 100% (4/4), 1.72 KiB | 1.72 MiB/s, done.
From github.com:drikin/Netaspace
   e716902..1374f07  main       -> origin/main
Updating e716902..1374f07
Fast-forward
 final-production-fix.sh | 101 +++++++++++++++++++++++++++++------------------------------------------------
 simple-start.sh         |  36 ++++++++++++++++++++++++++++
 2 files changed, 74 insertions(+), 63 deletions(-)
 create mode 100644 simple-start.sh
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
chmod +x simple-start.sh
./simple-start.sh
=== Simple PM2 Start - Production Fix ===
[PM2][WARN] No process found
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped
[PM2] Spawning PM2 daemon with pm2_home=/home/ubuntu/.pm2
[PM2] PM2 Successfully daemonized
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 0    │ online    │ 0%       │ 30.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
Application started with PM2

Checking status...
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 0    │ online    │ 0%       │ 63.4mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 10 lines for [all] processes (change the value with --lines option)
/home/ubuntu/.pm2/pm2.log last 10 lines:
PM2        | 2025-06-13T13:51:18: PM2 log: BUS socket file      : /home/ubuntu/.pm2/pub.sock
PM2        | 2025-06-13T13:51:18: PM2 log: Application log path : /home/ubuntu/.pm2/logs
PM2        | 2025-06-13T13:51:18: PM2 log: Worker Interval      : 30000
PM2        | 2025-06-13T13:51:18: PM2 log: Process dump file    : /home/ubuntu/.pm2/dump.pm2
PM2        | 2025-06-13T13:51:18: PM2 log: Concurrent actions   : 2
PM2        | 2025-06-13T13:51:18: PM2 log: SIGTERM timeout      : 1600
PM2        | 2025-06-13T13:51:18: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-06-13T13:51:18: PM2 log: ===============================================================================
PM2        | 2025-06-13T13:51:18: PM2 log: App [neta-app:0] starting in -fork mode-
PM2        | 2025-06-13T13:51:18: PM2 log: App [neta-app:0] online

/home/ubuntu/.pm2/logs/neta-app-error.log last 10 lines:
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1579ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1631ms
0|neta-app | Slow query detected: getWeekWithTopics took 1779ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1927ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1632ms
0|neta-app | Slow query detected: getWeekWithTopics took 1782ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1930ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1633ms
0|neta-app | Slow query detected: getWeekWithTopics took 1781ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1931ms

/home/ubuntu/.pm2/logs/neta-app-out.log last 10 lines:
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:41:29 PM [express] GET /api/weeks/active 200 in 3101ms :: {"id":2,"startDate":"2025-06-10","endDat…

0|neta-app  | Using PostgreSQL database with connection pool
0|neta-app  | 1:51:19 PM [express] serving on 0.0.0.0:5000
0|neta-app  | PostgreSQL connection established
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL database connection test successful
0|neta-app  | 1:51:25 PM [express] GET /api/auth/me 401 in 357ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:51:26 PM [express] GET /api/version 200 in 1187ms :: {"app":"2.5.0","extension":"2.1.1","releaseDa…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1718ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1867ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 2019ms
0|neta-app  | 1:51:28 PM [express] GET /api/weeks/active 200 in 3197ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | 1:51:31 PM [express] GET /api/auth/me 401 in 343ms :: {"message":"Not authenticated"}
0|neta-app  | 1:51:31 PM [express] GET /api/version 200 in 355ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1631ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1779ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1928ms
0|neta-app  | 1:51:34 PM [express] GET /api/weeks/active 200 in 3118ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:51:38 PM [express] GET /api/auth/me 401 in 297ms :: {"message":"Not authenticated"}
0|neta-app  | 1:51:39 PM [express] GET /api/version 200 in 355ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1638ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1787ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1936ms
0|neta-app  | 1:51:40 PM [express] GET /api/weeks/active 200 in 2260ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1681ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1829ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1978ms
0|neta-app  | 1:52:07 PM [express] GET /api/weeks/active 200 in 2938ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1630ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1779ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1928ms
0|neta-app  | 1:53:20 PM [express] GET /api/weeks/active 200 in 3096ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | 1:53:26 PM [express] GET /api/auth/me 401 in 292ms :: {"message":"Not authenticated"}
0|neta-app  | 1:53:29 PM [express] GET /api/auth/me 401 in 292ms :: {"message":"Not authenticated"}
0|neta-app  | 1:53:30 PM [express] GET /api/auth/me 401 in 292ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:53:31 PM [express] GET /api/version 200 in 1185ms :: {"app":"2.5.0","extension":"2.1.1","releaseDa…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1632ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1781ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1930ms
0|neta-app  | 1:53:33 PM [express] GET /api/weeks/active 200 in 3115ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopic took 296ms
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:53:36 PM [express] POST /api/topics/14/star 200 in 1195ms :: {"success":true,"starsCount":1,"hasSt…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getStarsCountByTopicId took 220ms
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1705ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1854ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 2002ms
0|neta-app  | 1:53:39 PM [express] GET /api/weeks/active 200 in 2299ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1632ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1780ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1929ms
0|neta-app  | 1:53:41 PM [express] GET /api/weeks/active 200 in 2224ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopic took 297ms
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:53:48 PM [express] POST /api/topics/14/star 200 in 1190ms :: {"success":true,"starsCount":0,"hasSt…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1630ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1779ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1927ms
0|neta-app  | 1:53:51 PM [express] GET /api/weeks/active 200 in 2223ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 1634ms
0|neta-app  | Slow query detected: getWeekWithTopics took 1783ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 1931ms
0|neta-app  | 1:53:53 PM [express] GET /api/weeks/active 200 in 2227ms :: {"id":2,"startDate":"2025-06-10","endDat…
^C
ubuntu@neta:~/Netaspace$ git pull
./remote: Enumerating objects: 11, done.
remote: Counting objects: 100% (11/11), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 7 (delta 4), reused 7 (delta 4), pack-reused 0 (from 0)
Unpacking objects: 100% (7/7), 2.05 KiB | 1.03 MiB/s, done.
From github.com:drikin/Netaspace
   1374f07..eb40fdf  main       -> origin/main
Updating 1374f07..eb40fdf
Fast-forward
 ...pp-PostgreSQL-connection-acquired--1749790320505_1749790320506.txt | 52 ++++++++++++++++++++++++++++++++
 deploy-performance-fix.sh                                             | 29 ++++++++++++++++++
 server/storage.ts                                                     | 35 ++++++++++++++-------
 3 files changed, 105 insertions(+), 11 deletions(-)
 create mode 100644 attached_assets/Pasted-0-neta-app-PostgreSQL-connection-acquired-from-pool-0-neta-app-PostgreSQL-connection-acquired--1749790320505_1749790320506.txt
 create mode 100644 deploy-performance-fix.sh
ubuntu@neta:~/Netaspace$ sh ./deploy.sh 
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 13:54:17] Starting deployment for neta.backspace.fm
-e [2025-06-13 13:54:17] Server: 153.125.147.133
-e [2025-06-13 13:54:17] Domain: neta.backspace.fm
-e [2025-06-13 13:54:17] Initial setup: false
-e [2025-06-13 13:54:17] Pulling latest code from GitHub...
HEAD is now at eb40fdf Improve website speed by optimizing data retrieval from the database
./deploy.sh: 54: [[: not found
-e [2025-06-13 13:54:19] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 13:54:29] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.18s

  dist/index.js  44.1kb

⚡ Done in 6ms
-e [2025-06-13 13:54:33] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 13:54:33] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 13:54:33] Managing PM2 processes...
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
-e [2025-06-13 13:54:34] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 41.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 13:54:34] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 13:54:34] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 13:54:34] Waiting for application to start...
-e [2025-06-13 13:54:39] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 13:54:39] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 144.7mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ pm2 logs neta-app
[TAILING] Tailing last 15 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 15 lines:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
0|neta-app | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|neta-app | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|neta-app |     at file:///home/ubuntu/Netaspace/dist/index.js:134:9
0|neta-app |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|neta-app |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
0|neta-app | Slow query detected: getTopicsByWeekId took 365ms
0|neta-app | Slow query detected: getWeekWithTopics took 543ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 724ms
0|neta-app | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app | Slow query detected: getWeekWithTopics took 534ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 712ms

/home/ubuntu/.pm2/logs/neta-app-out-0.log last 15 lines:
0|neta-app | 1:54:35 PM [express] serving on 0.0.0.0:5000
0|neta-app | PostgreSQL connection established
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL database connection test successful
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:54:45 PM [express] GET /api/auth/me 401 in 244ms :: {"message":"Not authenticated"}
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:54:45 PM [express] GET /api/version 200 in 297ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:54:47 PM [express] GET /api/weeks/active 200 in 1896ms :: {"id":2,"startDate":"2025-06-10","endDat…

0|neta-app  | 1:55:00 PM [express] GET /api/auth/me 401 in 299ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:55:01 PM [express] GET /api/version 200 in 1199ms :: {"app":"2.5.0","extension":"2.1.1","releaseDa…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app  | Slow query detected: getWeekWithTopics took 534ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 712ms
0|neta-app  | 1:55:02 PM [express] GET /api/weeks/active 200 in 1907ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:55:04 PM [express] GET /api/auth/me 401 in 298ms :: {"message":"Not authenticated"}
0|neta-app  | 1:55:04 PM [express] GET /api/version 200 in 298ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app  | Slow query detected: getWeekWithTopics took 533ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 711ms
0|neta-app  | 1:55:04 PM [express] GET /api/weeks/active 200 in 1009ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app  | Slow query detected: getWeekWithTopics took 534ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 713ms
0|neta-app  | 1:56:21 PM [express] GET /api/weeks/active 200 in 1686ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:56:36 PM [express] GET /api/version 200 in 242ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app  | Slow query detected: getWeekWithTopics took 534ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 712ms
0|neta-app  | 1:56:36 PM [express] GET /api/auth/me 401 in 299ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app  | Slow query detected: getWeekWithTopics took 533ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 711ms
0|neta-app  | 1:56:38 PM [express] GET /api/weeks/active 200 in 1894ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | 1:56:50 PM [express] GET /api/auth/me 401 in 1193ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 355ms
0|neta-app  | Slow query detected: getWeekWithTopics took 533ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 711ms
0|neta-app  | 1:57:04 PM [express] GET /api/weeks/active 200 in 1672ms :: {"id":2,"startDate":"2025-06-10","endDat…
^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 8, done.
remote: Counting objects: 100% (8/8), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 8 (delta 4), reused 8 (delta 4), pack-reused 0 (from 0)
Unpacking objects: 100% (8/8), 2.42 KiB | 1.21 MiB/s, done.
From github.com:drikin/Netaspace
   eb40fdf..5871319  main       -> origin/main
Updating eb40fdf..5871319
Fast-forward
 ...a-app-1-54-35-PM-express-serving-o-1749790512453_1749790512454.txt | 38 ++++++++++++++++++++++++++++++++
 production-performance-deploy.sh                                      | 22 ++++++++++++++++++
 quick-performance-deploy.sh                                           | 33 +++++++++++++++++++++++++++
 3 files changed, 93 insertions(+)
 create mode 100644 attached_assets/Pasted--home-ubuntu-pm2-logs-neta-app-out-0-log-last-15-lines-0-neta-app-1-54-35-PM-express-serving-o-1749790512453_1749790512454.txt
 create mode 100644 production-performance-deploy.sh
 create mode 100644 quick-performance-deploy.sh
ubuntu@neta:~/Netaspace$ sh ./deploy.sh 
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 13:58:42] Starting deployment for neta.backspace.fm
-e [2025-06-13 13:58:42] Server: 153.125.147.133
-e [2025-06-13 13:58:42] Domain: neta.backspace.fm
-e [2025-06-13 13:58:42] Initial setup: false
-e [2025-06-13 13:58:42] Pulling latest code from GitHub...
HEAD is now at 5871319 Improves website speed and responsiveness for a much better user experience
./deploy.sh: 54: [[: not found
-e [2025-06-13 13:58:45] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 13:58:54] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.34s

  dist/index.js  44.1kb

⚡ Done in 6ms
-e [2025-06-13 13:58:58] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 13:58:58] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 13:58:59] Managing PM2 processes...
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
-e [2025-06-13 13:58:59] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 40.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 13:59:00] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 13:59:00] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 13:59:00] Waiting for application to start...
-e [2025-06-13 13:59:05] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 13:59:05] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 144.2mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ pm2 logs neta-app
[TAILING] Tailing last 15 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 15 lines:
0|neta-app | Slow query detected: getWeekWithTopics took 533ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 711ms
0|neta-app | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app | Slow query detected: getWeekWithTopics took 533ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 711ms
0|neta-app | Slow query detected: getTopicsByWeekId took 356ms
0|neta-app | Slow query detected: getWeekWithTopics took 534ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 712ms
0|neta-app | Slow query detected: getActiveWeek took 1027ms
0|neta-app | Slow query detected: getTopicsByWeekId took 294ms
0|neta-app | Slow query detected: getWeekWithTopics took 440ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1467ms
0|neta-app | Slow query detected: getTopicsByWeekId took 291ms
0|neta-app | Slow query detected: getWeekWithTopics took 437ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 584ms

/home/ubuntu/.pm2/logs/neta-app-out-0.log last 15 lines:
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL database connection test successful
0|neta-app | PostgreSQL connection established
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:59:03 PM [express] GET /api/weeks/active 200 in 2433ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app | 1:59:04 PM [express] GET /api/auth/me 401 in 239ms :: {"message":"Not authenticated"}
0|neta-app | 1:59:05 PM [express] GET /api/version 200 in 971ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:59:06 PM [express] GET /api/weeks/active 200 in 1986ms :: {"id":2,"startDate":"2025-06-10","endDat…

0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:59:11 PM [express] GET /api/version 200 in 238ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 1:59:11 PM [express] GET /api/auth/me 401 in 241ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 292ms
0|neta-app  | Slow query detected: getWeekWithTopics took 437ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 582ms
0|neta-app  | 1:59:12 PM [express] GET /api/weeks/active 200 in 878ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:59:14 PM [express] GET /api/version 200 in 238ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 1:59:14 PM [express] GET /api/auth/me 401 in 241ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 291ms
0|neta-app  | Slow query detected: getWeekWithTopics took 437ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 582ms
0|neta-app  | 1:59:14 PM [express] GET /api/weeks/active 200 in 877ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 1:59:17 PM [express] GET /api/version 200 in 239ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 1:59:18 PM [express] GET /api/auth/me 401 in 261ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 291ms
0|neta-app  | Slow query detected: getWeekWithTopics took 438ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 584ms
0|neta-app  | 1:59:18 PM [express] GET /api/weeks/active 200 in 879ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL pool error: error: terminating connection due to administrator command
0|neta-app  |     at Parser.parseErrorMessage (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/parser.js:285:98)
0|neta-app  |     at Parser.handlePacket (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/parser.js:122:29)
0|neta-app  |     at Parser.parse (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/parser.js:35:38)
0|neta-app  |     at TLSSocket.<anonymous> (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/index.js:11:42)
0|neta-app  |     at TLSSocket.emit (node:events:524:28)
0|neta-app  |     at addChunk (node:internal/streams/readable:561:12)
0|neta-app  |     at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
0|neta-app  |     at Readable.push (node:internal/streams/readable:392:5)
0|neta-app  |     at TLSWrap.onStreamRead (node:internal/stream_base_commons:191:23) {
0|neta-app  |   length: 116,
0|neta-app  |   severity: 'FATAL',
0|neta-app  |   code: '57P01',
0|neta-app  |   detail: undefined,
0|neta-app  |   hint: undefined,
0|neta-app  |   position: undefined,
0|neta-app  |   internalPosition: undefined,
0|neta-app  |   internalQuery: undefined,
0|neta-app  |   where: undefined,
0|neta-app  |   schema: undefined,
0|neta-app  |   table: undefined,
0|neta-app  |   column: undefined,
0|neta-app  |   dataType: undefined,
0|neta-app  |   constraint: undefined,
0|neta-app  |   file: 'postgres.c',
0|neta-app  |   line: '3289',
0|neta-app  |   routine: 'ProcessInterrupts',
0|neta-app  |   client: Client {
0|neta-app  |     _events: [Object: null prototype] { error: [Function (anonymous)] },
0|neta-app  |     _eventsCount: 1,
0|neta-app  |     _maxListeners: undefined,
0|neta-app  |     connectionParameters: ConnectionParameters {
0|neta-app  |       user: 'neondb_owner',
0|neta-app  |       database: 'neondb',
0|neta-app  |       port: 5432,
0|neta-app  |       host: 'ep-hidden-thunder-a65mlh9x.us-west-2.aws.neon.tech',
0|neta-app  |       binary: false,
0|neta-app  |       options: undefined,
0|neta-app  |       ssl: {},
0|neta-app  |       client_encoding: '',
0|neta-app  |       replication: undefined,
0|neta-app  |       isDomainSocket: false,
0|neta-app  |       application_name: undefined,
0|neta-app  |       fallback_application_name: undefined,
0|neta-app  |       statement_timeout: 30000,
0|neta-app  |       lock_timeout: false,
0|neta-app  |       idle_in_transaction_session_timeout: false,
0|neta-app  |       query_timeout: 30000,
0|neta-app  |       connect_timeout: 15,
0|neta-app  |       keepalives: 1,
0|neta-app  |       keepalives_idle: 10
0|neta-app  |     },
0|neta-app  |     user: 'neondb_owner',
0|neta-app  |     database: 'neondb',
0|neta-app  |     port: 5432,
0|neta-app  |     host: 'ep-hidden-thunder-a65mlh9x.us-west-2.aws.neon.tech',
0|neta-app  |     replication: undefined,
0|neta-app  |     _Promise: [Function: Promise],
0|neta-app  |     _types: TypeOverrides { _types: [Object], text: {}, binary: {} },
0|neta-app  |     _ending: true,
0|neta-app  |     _ended: false,
0|neta-app  |     _connecting: false,
0|neta-app  |     _connected: true,
0|neta-app  |     _connectionError: false,
0|neta-app  |     _queryable: false,
0|neta-app  |     enableChannelBinding: false,
0|neta-app  |     connection: Connection {
0|neta-app  |       _events: [Object: null prototype],
0|neta-app  |       _eventsCount: 23,
0|neta-app  |       _maxListeners: undefined,
0|neta-app  |       stream: [TLSSocket],
0|neta-app  |       _keepAlive: true,
0|neta-app  |       _keepAliveInitialDelayMillis: 10000,
0|neta-app  |       lastBuffer: false,
0|neta-app  |       parsedStatements: {},
0|neta-app  |       ssl: {},
0|neta-app  |       _ending: true,
0|neta-app  |       _emitMessage: false,
0|neta-app  |       _connecting: true,
0|neta-app  |       [Symbol(shapeMode)]: false,
0|neta-app  |       [Symbol(kCapture)]: false
0|neta-app  |     },
0|neta-app  |     queryQueue: [],
0|neta-app  |     binary: false,
0|neta-app  |     processID: -89396513,
0|neta-app  |     secretKey: 1025653602,
0|neta-app  |     ssl: {},
0|neta-app  |     _connectionTimeoutMillis: 15000,
0|neta-app  |     _connectionCallback: null,
0|neta-app  |     connectionTimeoutHandle: Timeout {
0|neta-app  |       _idleTimeout: -1,
0|neta-app  |       _idlePrev: null,
0|neta-app  |       _idleNext: null,
0|neta-app  |       _idleStart: 1924,
0|neta-app  |       _onTimeout: null,
0|neta-app  |       _timerArgs: undefined,
0|neta-app  |       _repeat: null,
0|neta-app  |       _destroyed: true,
0|neta-app  |       [Symbol(refed)]: false,
0|neta-app  |       [Symbol(kHasPrimitive)]: false,
0|neta-app  |       [Symbol(asyncId)]: 851,
0|neta-app  |       [Symbol(triggerId)]: 0
0|neta-app  |     },
0|neta-app  |     saslSession: null,
0|neta-app  |     release: [Function (anonymous)],
0|neta-app  |     activeQuery: null,
0|neta-app  |     readyForQuery: true,
0|neta-app  |     hasExecuted: true,
0|neta-app  |     _poolUseCount: 20,
0|neta-app  |     [Symbol(shapeMode)]: false,
0|neta-app  |     [Symbol(kCapture)]: false
0|neta-app  |   }
0|neta-app  | }
0|neta-app  | PostgreSQL pool error: error: terminating connection due to administrator command
0|neta-app  |     at Parser.parseErrorMessage (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/parser.js:285:98)
0|neta-app  |     at Parser.handlePacket (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/parser.js:122:29)
0|neta-app  |     at Parser.parse (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/parser.js:35:38)
0|neta-app  |     at TLSSocket.<anonymous> (/home/ubuntu/Netaspace/node_modules/pg-protocol/dist/index.js:11:42)
0|neta-app  |     at TLSSocket.emit (node:events:524:28)
0|neta-app  |     at addChunk (node:internal/streams/readable:561:12)
0|neta-app  |     at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
0|neta-app  |     at Readable.push (node:internal/streams/readable:392:5)
0|neta-app  |     at TLSWrap.onStreamRead (node:internal/stream_base_commons:191:23) {
0|neta-app  |   length: 116,
0|neta-app  |   severity: 'FATAL',
0|neta-app  |   code: '57P01',
0|neta-app  |   detail: undefined,
0|neta-app  |   hint: undefined,
0|neta-app  |   position: undefined,
0|neta-app  |   internalPosition: undefined,
0|neta-app  |   internalQuery: undefined,
0|neta-app  |   where: undefined,
0|neta-app  |   schema: undefined,
0|neta-app  |   table: undefined,
0|neta-app  |   column: undefined,
0|neta-app  |   dataType: undefined,
0|neta-app  |   constraint: undefined,
0|neta-app  |   file: 'postgres.c',
0|neta-app  |   line: '3289',
0|neta-app  |   routine: 'ProcessInterrupts',
0|neta-app  |   client: Client {
0|neta-app  |     _events: [Object: null prototype] { error: [Function (anonymous)] },
0|neta-app  |     _eventsCount: 1,
0|neta-app  |     _maxListeners: undefined,
0|neta-app  |     connectionParameters: ConnectionParameters {
0|neta-app  |       user: 'neondb_owner',
0|neta-app  |       database: 'neondb',
0|neta-app  |       port: 5432,
0|neta-app  |       host: 'ep-hidden-thunder-a65mlh9x.us-west-2.aws.neon.tech',
0|neta-app  |       binary: false,
0|neta-app  |       options: undefined,
0|neta-app  |       ssl: {},
0|neta-app  |       client_encoding: '',
0|neta-app  |       replication: undefined,
0|neta-app  |       isDomainSocket: false,
0|neta-app  |       application_name: undefined,
0|neta-app  |       fallback_application_name: undefined,
0|neta-app  |       statement_timeout: 30000,
0|neta-app  |       lock_timeout: false,
0|neta-app  |       idle_in_transaction_session_timeout: false,
0|neta-app  |       query_timeout: 30000,
0|neta-app  |       connect_timeout: 15,
0|neta-app  |       keepalives: 1,
0|neta-app  |       keepalives_idle: 10
0|neta-app  |     },
0|neta-app  |     user: 'neondb_owner',
0|neta-app  |     database: 'neondb',
0|neta-app  |     port: 5432,
0|neta-app  |     host: 'ep-hidden-thunder-a65mlh9x.us-west-2.aws.neon.tech',
0|neta-app  |     replication: undefined,
0|neta-app  |     _Promise: [Function: Promise],
0|neta-app  |     _types: TypeOverrides { _types: [Object], text: {}, binary: {} },
0|neta-app  |     _ending: true,
0|neta-app  |     _ended: false,
0|neta-app  |     _connecting: false,
0|neta-app  |     _connected: true,
0|neta-app  |     _connectionError: false,
0|neta-app  |     _queryable: false,
0|neta-app  |     enableChannelBinding: false,
0|neta-app  |     connection: Connection {
0|neta-app  |       _events: [Object: null prototype],
0|neta-app  |       _eventsCount: 23,
0|neta-app  |       _maxListeners: undefined,
0|neta-app  |       stream: [TLSSocket],
0|neta-app  |       _keepAlive: true,
0|neta-app  |       _keepAliveInitialDelayMillis: 10000,
0|neta-app  |       lastBuffer: false,
0|neta-app  |       parsedStatements: {},
0|neta-app  |       ssl: {},
0|neta-app  |       _ending: false,
0|neta-app  |       _emitMessage: false,
0|neta-app  |       _connecting: true,
0|neta-app  |       [Symbol(shapeMode)]: false,
0|neta-app  |       [Symbol(kCapture)]: false
0|neta-app  |     },
0|neta-app  |     queryQueue: [],
0|neta-app  |     binary: false,
0|neta-app  |     processID: -1454148236,
0|neta-app  |     secretKey: 867154075,
0|neta-app  |     ssl: {},
0|neta-app  |     _connectionTimeoutMillis: 15000,
0|neta-app  |     _connectionCallback: null,
0|neta-app  |     connectionTimeoutHandle: Timeout {
0|neta-app  |       _idleTimeout: -1,
0|neta-app  |       _idlePrev: null,
0|neta-app  |       _idleNext: null,
0|neta-app  |       _idleStart: 857,
0|neta-app  |       _onTimeout: null,
0|neta-app  |       _timerArgs: undefined,
0|neta-app  |       _repeat: null,
0|neta-app  |       _destroyed: true,
0|neta-app  |       [Symbol(refed)]: false,
0|neta-app  |       [Symbol(kHasPrimitive)]: false,
0|neta-app  |       [Symbol(asyncId)]: 782,
0|neta-app  |       [Symbol(triggerId)]: 0
0|neta-app  |     },
0|neta-app  |     saslSession: null,
0|neta-app  |     release: [Function (anonymous)],
0|neta-app  |     activeQuery: null,
0|neta-app  |     readyForQuery: true,
0|neta-app  |     hasExecuted: true,
0|neta-app  |     _poolUseCount: 1,
0|neta-app  |     [Symbol(shapeMode)]: false,
0|neta-app  |     [Symbol(kCapture)]: false
0|neta-app  |   }
0|neta-app  | }
^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 12, done.
remote: Counting objects: 100% (12/12), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 8 (delta 4), reused 8 (delta 4), pack-reused 0 (from 0)
Unpacking objects: 100% (8/8), 2.43 KiB | 1.22 MiB/s, done.
From github.com:drikin/Netaspace
   5871319..9e77e66  main       -> origin/main
Updating 5871319..9e77e66
Fast-forward
 ...ta-app-PostgreSQL-connection-acqui-1749790776700_1749790776700.txt | 38 ++++++++++++++++++++++++++++++++
 comprehensive-performance-fix.sh                                      | 38 ++++++++++++++++++++++++++++++++
 server/db.ts                                                          | 18 +++++++--------
 ultra-performance-deploy.sh                                           | 22 ++++++++++++++++++
 4 files changed, 107 insertions(+), 9 deletions(-)
 create mode 100644 attached_assets/Pasted-eDat-0-neta-app-PostgreSQL-connection-acquired-from-pool-0-neta-app-PostgreSQL-connection-acqui-1749790776700_1749790776700.txt
 create mode 100644 comprehensive-performance-fix.sh
 create mode 100644 ultra-performance-deploy.sh
ubuntu@neta:~/Netaspace$ sh ./deploy.sh 
./deploy.sh: 8: Bad substitution
./deploy.sh: 35: [[: not found
-e [2025-06-13 14:02:41] Starting deployment for neta.backspace.fm
-e [2025-06-13 14:02:41] Server: 153.125.147.133
-e [2025-06-13 14:02:41] Domain: neta.backspace.fm
-e [2025-06-13 14:02:41] Initial setup: false
-e [2025-06-13 14:02:41] Pulling latest code from GitHub...
HEAD is now at 9e77e66 Improve database responsiveness for faster loading times and better user experience
./deploy.sh: 54: [[: not found
-e [2025-06-13 14:02:43] Installing Node.js dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 624 packages, and audited 625 packages in 9s

88 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
-e [2025-06-13 14:02:52] Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.28s

  dist/index.js  44.0kb

⚡ Done in 6ms
-e [2025-06-13 14:02:57] Setting up environment variables...
./deploy.sh: 95: [[: not found
-e [2025-06-13 14:02:57] Setting up database...
./deploy.sh: 106: [[: not found

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/ubuntu/Netaspace/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
-e [WARNING] Database update failed. Continuing with deployment...
-e [2025-06-13 14:02:57] Managing PM2 processes...
[PM2] Applying action stopProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
-e [2025-06-13 14:02:58] Starting application with PM2...
./deploy.sh: 121: [[: not found
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in cluster_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 40.5mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /home/ubuntu/.pm2/dump.pm2
./deploy.sh: 130: [[: not found
-e [2025-06-13 14:02:58] Configuring Nginx...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
-e [2025-06-13 14:02:58] Nginx configuration applied successfully
./deploy.sh: 244: [[: not found
-e [2025-06-13 14:02:58] Waiting for application to start...
-e [2025-06-13 14:03:03] Performing health check...
./deploy.sh: 263: [[: not found
-e [2025-06-13 14:03:03] Deployment completed successfully!

Application Status:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ cluster  │ 0    │ online    │ 0%       │ 140.1mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Access URLs:
- HTTPS: https://neta.backspace.fm
- HTTP: http://153.125.147.133 (redirects to HTTPS)

Management Commands:
- View logs: pm2 logs neta-app
- Restart: pm2 restart neta-app
- Status: pm2 status
- Nginx logs: sudo tail -f /var/log/nginx/neta.backspace.fm.error.log

Update deployment: git pull && ./deploy.sh
Health check: curl -I https://neta.backspace.fm/health
ubuntu@neta:~/Netaspace$ pm2 logs neta-app
[TAILING] Tailing last 15 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-error-0.log last 15 lines:
0|neta-app | }
0|neta-app | Slow query detected: getActiveWeek took 1055ms
0|neta-app | Slow query detected: getTopicsByWeekId took 303ms
0|neta-app | Slow query detected: getWeekWithTopics took 454ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1509ms
0|neta-app | Slow query detected: getActiveWeek took 1233ms
0|neta-app | Slow query detected: getTopicsByWeekId took 352ms
0|neta-app | Slow query detected: getWeekWithTopics took 527ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1760ms
0|neta-app | Slow query detected: getTopicsByWeekId took 297ms
0|neta-app | Slow query detected: getWeekWithTopics took 445ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 596ms
0|neta-app | Slow query detected: getTopicsByWeekId took 295ms
0|neta-app | Slow query detected: getWeekWithTopics took 442ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 590ms

/home/ubuntu/.pm2/logs/neta-app-out-0.log last 15 lines:
0|neta-app | 2:02:59 PM [express] serving on 0.0.0.0:5000
0|neta-app | PostgreSQL connection established
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL database connection test successful
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 2:04:28 PM [express] GET /api/auth/me 401 in 244ms :: {"message":"Not authenticated"}
0|neta-app | 2:04:28 PM [express] GET /api/version 200 in 294ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 2:04:30 PM [express] GET /api/weeks/active 200 in 1999ms :: {"id":2,"startDate":"2025-06-10","endDat…

0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:04:35 PM [express] GET /api/version 200 in 293ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 2:04:35 PM [express] GET /api/auth/me 401 in 348ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 295ms
0|neta-app  | Slow query detected: getWeekWithTopics took 442ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 589ms
0|neta-app  | 2:04:35 PM [express] GET /api/weeks/active 200 in 886ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:04:37 PM [express] GET /api/version 200 in 243ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 2:04:37 PM [express] GET /api/auth/me 401 in 294ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 294ms
0|neta-app  | Slow query detected: getWeekWithTopics took 441ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 589ms
0|neta-app  | 2:04:38 PM [express] GET /api/weeks/active 200 in 910ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:04:40 PM [express] GET /api/version 200 in 243ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 2:04:40 PM [express] GET /api/auth/me 401 in 293ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 297ms
0|neta-app  | Slow query detected: getWeekWithTopics took 449ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 596ms
0|neta-app  | 2:04:40 PM [express] GET /api/weeks/active 200 in 917ms :: {"id":2,"startDate":"2025-06-10","endDate…
^C
ubuntu@neta:~/Netaspace$ git pull
Already up to date.
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 8, done.
remote: Counting objects: 100% (8/8), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 6 (delta 2), reused 6 (delta 2), pack-reused 0 (from 0)
Unpacking objects: 100% (6/6), 2.42 KiB | 2.42 MiB/s, done.
From github.com:drikin/Netaspace
   9e77e66..857edfa  main       -> origin/main
Updating 9e77e66..857edfa
Fast-forward
 ...00-in-1999ms-id-2-startDate-2025-0-1749791087123_1749791087124.txt | 33 +++++++++++++++++++++++
 force-production-sync.sh                                              | 45 ++++++++++++++++++++++++++++++++
 production-performance-emergency.sh                                   | 37 ++++++++++++++++++++++++++
 3 files changed, 115 insertions(+)
 create mode 100644 attached_assets/Pasted-0-neta-app-2-04-30-PM-express-GET-api-weeks-active-200-in-1999ms-id-2-startDate-2025-0-1749791087123_1749791087124.txt
 create mode 100644 force-production-sync.sh
 create mode 100644 production-performance-emergency.sh
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
chmod +x force-production-sync.sh
./force-production-sync.sh
=== Force Production Performance Sync ===
Checking N+1 optimization status...
✓ N+1 query optimization found
✓ Connection pool optimization found
Force rebuilding with all optimizations...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.29s

  dist/index.js  44.0kb

⚡ Done in 6ms
[PM2] Applying action deleteProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Flushing /home/ubuntu/.pm2/pm2.log
[PM2] Logs flushed
[PM2] Starting /home/ubuntu/Netaspace/dist/index.js in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 0    │ online    │ 0%       │ 18.5mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

Production sync complete. Expected performance:
- Query time: 294-596ms → 80-200ms
- Total response: 886-1999ms → 300-600ms

Testing optimized performance...
[TAILING] Tailing last 25 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-error.log last 25 lines:
0|neta-app | Slow query detected: getTopicsByWeekId took 1632ms
0|neta-app | Slow query detected: getWeekWithTopics took 1781ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1930ms
0|neta-app | Slow query detected: getTopic took 296ms
0|neta-app | Slow query detected: getStarsCountByTopicId took 220ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1705ms
0|neta-app | Slow query detected: getWeekWithTopics took 1854ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 2002ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1632ms
0|neta-app | Slow query detected: getWeekWithTopics took 1780ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1929ms
0|neta-app | Slow query detected: getTopic took 297ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1630ms
0|neta-app | Slow query detected: getWeekWithTopics took 1779ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1927ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1634ms
0|neta-app | Slow query detected: getWeekWithTopics took 1783ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1931ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1629ms
0|neta-app | Slow query detected: getWeekWithTopics took 1777ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 1926ms
0|neta-app | Slow query detected: getActiveWeek took 1226ms
0|neta-app | Slow query detected: getTopicsByWeekId took 1913ms
0|neta-app | Slow query detected: getWeekWithTopics took 2087ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 3314ms

/home/ubuntu/.pm2/logs/neta-app-out.log last 25 lines:
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection established
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 1:54:09 PM [express] GET /api/weeks/active 200 in 4716ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app | Using PostgreSQL database with connection pool
0|neta-app | 2:06:34 PM [express] serving on 0.0.0.0:5000
0|neta-app | PostgreSQL connection established
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL database connection test successful

0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:06:45 PM [express] GET /api/auth/me 401 in 244ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 245ms
0|neta-app  | Slow query detected: getWeekWithTopics took 365ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 489ms
0|neta-app  | 2:06:45 PM [express] GET /api/version 200 in 964ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 242ms
0|neta-app  | Slow query detected: getWeekWithTopics took 363ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 483ms
0|neta-app  | 2:06:46 PM [express] GET /api/weeks/active 200 in 1696ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:06:49 PM [express] GET /api/version 200 in 243ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:06:49 PM [express] GET /api/auth/me 401 in 303ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 242ms
0|neta-app  | Slow query detected: getWeekWithTopics took 363ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 483ms
0|neta-app  | 2:06:49 PM [express] GET /api/weeks/active 200 in 757ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:06:53 PM [express] GET /api/version 200 in 238ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:06:53 PM [express] GET /api/auth/me 401 in 315ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 244ms
0|neta-app  | Slow query detected: getWeekWithTopics took 364ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 485ms
0|neta-app  | 2:06:53 PM [express] GET /api/weeks/active 200 in 758ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 241ms
0|neta-app  | Slow query detected: getWeekWithTopics took 363ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 484ms
0|neta-app  | 2:07:16 PM [express] GET /api/auth/me 401 in 297ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:17 PM [express] GET /api/version 200 in 1188ms :: {"app":"2.5.0","extension":"2.1.1","releaseDa…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 242ms
0|neta-app  | Slow query detected: getWeekWithTopics took 363ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 483ms
0|neta-app  | 2:07:18 PM [express] GET /api/weeks/active 200 in 1657ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 241ms
0|neta-app  | Slow query detected: getWeekWithTopics took 363ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 483ms
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:24 PM [express] GET /api/auth/me 401 in 295ms :: {"message":"Not authenticated"}
0|neta-app  | 2:07:24 PM [express] GET /api/version 200 in 298ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 241ms
0|neta-app  | Slow query detected: getWeekWithTopics took 361ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 482ms
0|neta-app  | 2:07:24 PM [express] GET /api/weeks/active 200 in 779ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | 2:07:26 PM [express] GET /api/auth/me 401 in 297ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:30 PM [express] POST /api/auth/login 200 in 724ms :: {"user":{"id":1,"username":"admin","passwo…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:30 PM [express] GET /api/auth/me 200 in 417ms :: {"user":{"id":1,"username":"admin","password":…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:31 PM [express] GET /api/auth/me 200 in 418ms :: {"user":{"id":1,"username":"admin","password":…
0|neta-app  | PostgreSQL connection established
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getUser took 842ms
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection established
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:32 PM [express] GET /api/weeks 200 in 1259ms :: [{"id":2,"startDate":"2025-06-10","endDate":"20…
0|neta-app  | Slow query detected: getUser took 1233ms
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getTopicsByWeekId took 351ms
0|neta-app  | Slow query detected: getWeekWithTopics took 526ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 700ms
0|neta-app  | 2:07:33 PM [express] GET /api/weeks/active 200 in 2233ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:07:36 PM [express] POST /api/auth/logout 200 in 771ms :: {"success":true}
0|neta-app  | 2:07:36 PM [express] GET /api/auth/me 401 in 299ms :: {"message":"Not authenticated"}
0|neta-app  | 2:07:40 PM [express] GET /api/auth/me 401 in 297ms :: {"message":"Not authenticated"}
^C
ubuntu@neta:~/Netaspace$ git pull
remote: Enumerating objects: 11, done.
remote: Counting objects: 100% (11/11), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 7 (delta 4), reused 7 (delta 4), pack-reused 0 (from 0)
Unpacking objects: 100% (7/7), 3.35 KiB | 1.68 MiB/s, done.
From github.com:drikin/Netaspace
   857edfa..5468bf2  main       -> origin/main
Updating 857edfa..5468bf2
Fast-forward
 ...oduction-performance-emergency-sh--1749791232403_1749791232403.txt | 145 +++++++++++++++++++++++++++++++
 final-performance-deploy.sh                                           |  20 +++++
 server/storage.ts                                                     |  26 +++++-
 3 files changed, 188 insertions(+), 3 deletions(-)
 create mode 100644 attached_assets/Pasted-create-mode-100644-force-production-sync-sh-create-mode-100644-production-performance-emergency-sh--1749791232403_1749791232403.txt
 create mode 100644 final-performance-deploy.sh
ubuntu@neta:~/Netaspace$ cd ~/Netaspace
chmod +x final-performance-deploy.sh
./final-performance-deploy.sh
=== Final Performance Optimization Deploy ===

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 1843 modules transformed.
../dist/public/index.html                   0.89 kB │ gzip:   0.56 kB
../dist/public/assets/index-CU4f6s9j.css   69.09 kB │ gzip:  12.02 kB
../dist/public/assets/index-D7cqMrFt.js   514.12 kB │ gzip: 161.06 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 4.20s

  dist/index.js  44.7kb

⚡ Done in 8ms
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [neta-app](ids: [ 0 ])
[PM2] [neta-app](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ neta-app           │ fork     │ 1    │ online    │ 0%       │ 18.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
Final optimizations deployed:
- Eliminated N+1 queries with JOIN optimization
- Target: 242-245ms → 50-100ms query time
- Expected total response: 757-964ms → 200-400ms

Testing final performance...
[TAILING] Tailing last 10 lines for [neta-app] process (change the value with --lines option)
/home/ubuntu/.pm2/logs/neta-app-error.log last 10 lines:
0|neta-app | Slow query detected: getWeekWithTopics took 363ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 483ms
0|neta-app | Slow query detected: getTopicsByWeekId took 241ms
0|neta-app | Slow query detected: getWeekWithTopics took 361ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 482ms
0|neta-app | Slow query detected: getUser took 842ms
0|neta-app | Slow query detected: getUser took 1233ms
0|neta-app | Slow query detected: getTopicsByWeekId took 351ms
0|neta-app | Slow query detected: getWeekWithTopics took 526ms
0|neta-app | Slow query detected: getActiveWeekWithTopics took 700ms

/home/ubuntu/.pm2/logs/neta-app-out.log last 10 lines:
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | 2:07:36 PM [express] POST /api/auth/logout 200 in 771ms :: {"success":true}
0|neta-app | 2:07:36 PM [express] GET /api/auth/me 401 in 299ms :: {"message":"Not authenticated"}
0|neta-app | 2:07:40 PM [express] GET /api/auth/me 401 in 297ms :: {"message":"Not authenticated"}
0|neta-app | Using PostgreSQL database with connection pool
0|neta-app | 2:08:15 PM [express] serving on 0.0.0.0:5000
0|neta-app | PostgreSQL connection established
0|neta-app | PostgreSQL connection acquired from pool
0|neta-app | PostgreSQL database connection test successful
0|neta-app | PostgreSQL connection acquired from pool

0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getWeekWithTopics took 288ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 409ms
0|neta-app  | 2:08:20 PM [express] GET /api/weeks/active 200 in 1603ms :: {"id":2,"startDate":"2025-06-10","endDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:08:21 PM [express] GET /api/auth/me 401 in 296ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getWeekWithTopics took 235ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 353ms
0|neta-app  | 2:08:21 PM [express] GET /api/weeks/active 200 in 678ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | 2:08:21 PM [express] GET /api/version 200 in 967ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | 2:08:22 PM [express] GET /api/auth/me 401 in 240ms :: {"message":"Not authenticated"}
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:08:22 PM [express] GET /api/version 200 in 295ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getWeekWithTopics took 235ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 352ms
0|neta-app  | 2:08:23 PM [express] GET /api/weeks/active 200 in 676ms :: {"id":2,"startDate":"2025-06-10","endDate…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | 2:08:24 PM [express] GET /api/auth/me 401 in 295ms :: {"message":"Not authenticated"}
0|neta-app  | 2:08:24 PM [express] GET /api/version 200 in 352ms :: {"app":"2.5.0","extension":"2.1.1","releaseDat…
0|neta-app  | PostgreSQL connection acquired from pool
0|neta-app  | Slow query detected: getWeekWithTopics took 235ms
0|neta-app  | Slow query detected: getActiveWeekWithTopics took 352ms
0|neta-app  | 2:08:25 PM [express] GET /api/weeks/active 200 in 649ms :: {"id":2,"startDate":"2025-06-10","endDate…

